<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìš´ë™ & ì‹ë‹¨ ê¸°ë¡</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background-color: #f5f5f5;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            color: #2c3e50;
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .profile-button {
            background-color: #27ae60;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9em;
            margin-bottom: 20px;
        }

        .profile-button:hover {
            background-color: #219a52;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }

        .modal-content {
            background-color: #fefefe;
            margin: 5% auto;
            padding: 30px;
            border: none;
            border-radius: 10px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close:hover {
            color: #000;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 15px;
        }

        .profile-info {
            background: #e8f5e8;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            border-left: 4px solid #27ae60;
        }

        .profile-info h3 {
            margin: 0 0 10px 0;
            color: #27ae60;
        }

        .profile-info p {
            margin: 5px 0;
            color: #555;
        }

        .tabs {
            display: flex;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            overflow: hidden;
        }

        .tab-button {
            flex: 1;
            padding: 15px 20px;
            background: #f8f9fa;
            border: none;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s;
            border-right: 1px solid #ddd;
        }

        .tab-button:last-child {
            border-right: none;
        }

        .tab-button.active {
            background: #3498db;
            color: white;
        }

        .tab-button:hover:not(.active) {
            background: #e9ecef;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .comparison-section {
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .comparison-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }

        .comparison-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            border-left: 4px solid #3498db;
        }

        .comparison-item.planned {
            border-left-color: #f39c12;
        }

        .comparison-item.actual {
            border-left-color: #27ae60;
        }

        .progress-bar {
            background: #e9ecef;
            border-radius: 10px;
            height: 20px;
            margin: 10px 0;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #3498db, #2ecc71);
            transition: width 0.3s ease;
            border-radius: 10px;
        }

        .achievement-badge {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.8em;
            font-weight: bold;
            margin-left: 10px;
        }

        .achievement-badge.excellent {
            background: #27ae60;
            color: white;
        }

        .achievement-badge.good {
            background: #f39c12;
            color: white;
        }

        .achievement-badge.needs-improvement {
            background: #e74c3c;
            color: white;
        }

        .plan-item {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-left: 4px solid #f39c12;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .plan-info {
            flex: 1;
        }

        .plan-status {
            font-weight: bold;
            margin-right: 10px;
        }

        .plan-status.completed {
            color: #27ae60;
        }

        .plan-status.partial {
            color: #f39c12;
        }

        .plan-status.pending {
            color: #e74c3c;
        }

        .recommendation-section {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .recommendation-section h3 {
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .recommendation-button {
            background: rgba(255,255,255,0.2);
            color: white;
            border: 2px solid rgba(255,255,255,0.3);
            padding: 12px 25px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s;
            margin: 10px;
        }

        .recommendation-button:hover {
            background: rgba(255,255,255,0.3);
            transform: translateY(-2px);
        }

        .recommendation-result {
            background: rgba(255,255,255,0.1);
            padding: 20px;
            border-radius: 10px;
            margin-top: 15px;
            border: 1px solid rgba(255,255,255,0.2);
        }

        .recommendation-result h4 {
            color: #ffd700;
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        .recommendation-result p {
            margin: 5px 0;
            line-height: 1.6;
        }

        .encouragement-text {
            font-style: italic;
            color: #e8f5e8;
            margin-top: 10px;
            font-size: 0.95em;
        }

        .exercise-recommendation {
            background: rgba(255,255,255,0.15);
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            border-left: 4px solid #ffd700;
        }

        .add-to-plan-btn {
            background: #27ae60;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9em;
            margin-top: 10px;
            transition: background 0.3s;
        }

        .add-to-plan-btn:hover {
            background: #219a52;
        }

        .nutrition-scanner {
            background: #f8f9fa;
            border: 2px dashed #dee2e6;
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
            text-align: center;
            transition: all 0.3s;
        }

        .nutrition-scanner:hover {
            border-color: #3498db;
            background: #e3f2fd;
        }

        .nutrition-scanner.active {
            border-color: #27ae60;
            background: #e8f5e8;
        }

        .scanner-button {
            background: #17a2b8;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            margin: 5px;
            transition: background 0.3s;
        }

        .scanner-button:hover {
            background: #138496;
        }

        .scanner-button:disabled {
            background: #6c757d;
            cursor: not-allowed;
        }

        .image-preview {
            max-width: 100%;
            max-height: 200px;
            border-radius: 5px;
            margin: 10px 0;
            border: 1px solid #dee2e6;
        }

        .analysis-result {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 5px;
            padding: 15px;
            margin: 10px 0;
            display: none;
        }

        .analysis-result.success {
            background: #d4edda;
            border-color: #c3e6cb;
        }

        .analysis-result.error {
            background: #f8d7da;
            border-color: #f5c6cb;
        }

        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid #f3f3f3;
            border-top: 2px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .nutrition-info {
            background: #e8f5e8;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            border-left: 4px solid #27ae60;
        }

        .nutrition-info h5 {
            margin: 0 0 10px 0;
            color: #27ae60;
        }

        .nutrition-values {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
        }

        .nutrition-value {
            background: white;
            padding: 8px;
            border-radius: 3px;
            text-align: center;
            font-size: 0.9em;
        }

        .apply-nutrition-btn {
            background: #27ae60;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            width: 100%;
            margin-top: 10px;
        }

        .apply-nutrition-btn:hover {
            background: #219a52;
        }

        .web-search-section {
            background: #e8f4fd;
            border: 2px dashed #3498db;
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
            text-align: center;
            transition: all 0.3s;
        }

        .web-search-section:hover {
            border-color: #2980b9;
            background: #dbeafe;
        }

        .web-search-section.searching {
            border-color: #f39c12;
            background: #fef3cd;
        }

        .web-search-button {
            background: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            margin: 5px;
            transition: background 0.3s;
        }

        .web-search-button:hover {
            background: #2980b9;
        }

        .web-search-button:disabled {
            background: #95a5a6;
            cursor: not-allowed;
        }

        .search-input-container {
            display: flex;
            gap: 10px;
            margin: 15px 0;
            justify-content: center;
            align-items: center;
        }

        .web-search-input {
            flex: 1;
            max-width: 300px;
            padding: 10px;
            border: 2px solid #3498db;
            border-radius: 5px;
            font-size: 1em;
        }

        .web-search-results {
            background: #fff;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 15px;
            margin: 15px 0;
            display: none;
            text-align: left;
        }

        .web-search-results.show {
            display: block;
        }

        .web-search-results.success {
            background: #d4edda;
            border-color: #c3e6cb;
        }

        .web-search-results.error {
            background: #f8d7da;
            border-color: #f5c6cb;
        }

        .nutrition-found {
            background: #e8f5e8;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
            border-left: 4px solid #27ae60;
        }

        .nutrition-found h5 {
            color: #27ae60;
            margin: 0 0 10px 0;
        }

        .nutrition-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 10px;
            margin: 10px 0;
        }

        .nutrition-item {
            background: white;
            padding: 8px;
            border-radius: 3px;
            text-align: center;
            font-size: 0.9em;
            border: 1px solid #ddd;
        }

        .nutrition-item strong {
            display: block;
            color: #2c3e50;
        }

        .apply-web-search-btn {
            background: #27ae60;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            width: 100%;
            margin-top: 10px;
            font-size: 1em;
        }

        .apply-web-search-btn:hover {
            background: #219a52;
        }

        .search-sources {
            font-size: 0.85em;
            color: #666;
            margin-top: 10px;
            font-style: italic;
        }

        .search-disclaimer {
            font-size: 0.8em;
            color: #666;
            margin-top: 10px;
            padding: 8px;
            background: #f8f9fa;
            border-radius: 3px;
        }

        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #f8d7da;
            color: #721c24;
            padding: 15px 20px;
            border-radius: 5px;
            border: 1px solid #f5c6cb;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 9999;
            opacity: 0;
            transform: translateY(-20px);
            transition: all 0.3s ease;
            max-width: 350px;
            font-size: 0.9em;
        }

        .toast.show {
            opacity: 1;
            transform: translateY(0);
        }

        .toast.success {
            background: #d4edda;
            color: #155724;
            border-color: #c3e6cb;
        }

        .toast.warning {
            background: #fff3cd;
            color: #856404;
            border-color: #ffeaa7;
        }

        .toast.info {
            background: #d1ecf1;
            color: #0c5460;
            border-color: #bee5eb;
        }

        .toast-close {
            float: right;
            background: none;
            border: none;
            font-size: 1.2em;
            cursor: pointer;
            color: inherit;
            margin-left: 10px;
        }

        .nutrition-input {
            position: relative;
        }

        .nutrition-input.error {
            animation: shake 0.3s ease-in-out;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        .encouragement-modal {
            display: none;
            position: fixed;
            z-index: 1002;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.6);
            animation: fadeIn 0.3s ease;
        }

        .encouragement-modal-content {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            margin: 10% auto;
            padding: 40px;
            border: none;
            border-radius: 20px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            text-align: center;
            color: white;
            position: relative;
            animation: slideUp 0.4s ease;
        }

        .encouragement-modal h2 {
            margin-bottom: 20px;
            font-size: 1.8em;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .encouragement-message {
            font-size: 1.2em;
            line-height: 1.6;
            margin-bottom: 30px;
            text-shadow: 0 1px 2px rgba(0,0,0,0.2);
        }

        .encouragement-stats {
            background: rgba(255,255,255,0.15);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            backdrop-filter: blur(5px);
        }

        .encouragement-stats h4 {
            margin-bottom: 15px;
            font-size: 1.1em;
        }

        .achievement-detail {
            display: flex;
            justify-content: space-between;
            margin: 8px 0;
            font-size: 0.95em;
        }

        .achievement-detail strong {
            color: #ffd700;
        }

        .encouragement-ok-btn {
            background: rgba(255,255,255,0.2);
            color: white;
            border: 2px solid rgba(255,255,255,0.3);
            padding: 12px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1.1em;
            transition: all 0.3s;
            text-shadow: 0 1px 2px rgba(0,0,0,0.2);
        }

        .encouragement-ok-btn:hover {
            background: rgba(255,255,255,0.3);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .celebration-emoji {
            font-size: 3em;
            margin-bottom: 20px;
            animation: bounce 0.6s ease infinite alternate;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes bounce {
            from { transform: translateY(0); }
            to { transform: translateY(-10px); }
        }

        .encouragement-modal.show {
            display: block;
        }

        .edit-record-btn {
            background: #f39c12;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.85em;
            margin-right: 5px;
            transition: background 0.3s;
        }

        .edit-record-btn:hover {
            background: #e67e22;
        }

        .record-actions {
            display: flex;
            gap: 5px;
            align-items: center;
        }

        .edit-modal {
            display: none;
            position: fixed;
            z-index: 1001;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }

        .edit-modal-content {
            background-color: #fefefe;
            margin: 5% auto;
            padding: 30px;
            border: none;
            border-radius: 10px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
        }

        .edit-modal h3 {
            margin-bottom: 20px;
            color: #2c3e50;
        }

        .edit-form-group {
            margin-bottom: 15px;
        }

        .edit-form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #555;
        }

        .edit-form-group input, .edit-form-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1em;
        }

        .edit-form-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 20px;
        }

        .edit-save-btn {
            background: #27ae60;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
        }

        .edit-save-btn:hover {
            background: #219a52;
        }

        .edit-cancel-btn {
            background: #95a5a6;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
        }

        .edit-cancel-btn:hover {
            background: #7f8c8d;
        }

        .edit-profile-btn {
            background: #f39c12;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9em;
            margin-left: 10px;
            transition: background 0.3s;
        }

        .edit-profile-btn:hover {
            background: #e67e22;
        }

        .profile-actions {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-top: 10px;
        }

        .profile-display-text {
            flex: 1;
        }

        .date-selector {
            text-align: center;
            margin-bottom: 30px;
        }

        .date-selector input {
            padding: 10px;
            border: 2px solid #3498db;
            border-radius: 5px;
            font-size: 1em;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .section {
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .section h2 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.5em;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #555;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1em;
        }

        .search-container {
            position: relative;
            margin-bottom: 15px;
        }

        .search-results {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 1px solid #ddd;
            border-top: none;
            max-height: 200px;
            overflow-y: auto;
            z-index: 1000;
            display: none;
        }

        .search-item {
            padding: 10px;
            cursor: pointer;
            border-bottom: 1px solid #eee;
        }

        .search-item:hover {
            background-color: #f0f0f0;
        }

        .btn {
            background-color: #3498db;
            color: white;
            padding: 12px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            transition: background-color 0.3s;
        }

        .btn:hover {
            background-color: #2980b9;
        }

        .btn-danger {
            background-color: #e74c3c;
        }

        .btn-danger:hover {
            background-color: #c0392b;
        }

        .records {
            margin-top: 20px;
        }

        .record-item {
            background: #f8f9fa;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 5px;
            border-left: 4px solid #3498db;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .record-info {
            flex: 1;
        }

        .record-calories {
            font-weight: bold;
            color: #e74c3c;
            margin-right: 10px;
        }

        .summary {
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            text-align: center;
        }

        .summary h2 {
            color: #2c3e50;
            margin-bottom: 20px;
        }

        .summary-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
        }

        .stat-item {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 5px;
            border-left: 4px solid #3498db;
        }

        .stat-value {
            font-size: 2em;
            font-weight: bold;
            color: #2c3e50;
        }

        .stat-label {
            color: #7f8c8d;
            font-size: 0.9em;
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .summary-stats {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ’ª ìš´ë™ & ì‹ë‹¨ ê¸°ë¡</h1>
            <p>ê±´ê°•í•œ ìƒí™œì„ ìœ„í•œ ìš´ë™ê³¼ ì‹ë‹¨ ê´€ë¦¬</p>
            <button class="profile-button" onclick="openProfileModal()">âš™ï¸ í”„ë¡œí•„ ì„¤ì •</button>
            <div id="profileInfo" class="profile-info" style="display: none;">
                <h3>ğŸ‘¤ ë‚´ ì •ë³´</h3>
                <div class="profile-actions">
                    <div class="profile-display-text">
                        <p id="profileDisplay"></p>
                    </div>
                    <button class="edit-profile-btn" onclick="editProfile()">âœï¸ ìˆ˜ì •</button>
                </div>
            </div>
        </div>

        <div class="date-selector">
            <label for="recordDate">ë‚ ì§œ ì„ íƒ:</label>
            <input type="date" id="recordDate">
        </div>

        <div class="tabs">
            <button class="tab-button active" onclick="showTab('record')">ğŸ“ ê¸°ë¡</button>
            <button class="tab-button" onclick="showTab('plan')">ğŸ“‹ ê³„íš</button>
            <button class="tab-button" onclick="showTab('compare')">ğŸ“Š ë¹„êµ</button>
        </div>

        <div id="recordTab" class="tab-content active">
            <div class="main-content">
            <div class="section">
                <h2>ğŸƒâ€â™€ï¸ ìš´ë™ ê¸°ë¡</h2>
                <form id="exerciseForm">
                    <div class="form-group">
                        <label for="exerciseSearch">ìš´ë™ ê²€ìƒ‰:</label>
                        <div class="search-container">
                            <input type="text" id="exerciseSearch" placeholder="ìš´ë™ ì´ë¦„ì„ ê²€ìƒ‰í•˜ì„¸ìš”">
                            <div class="search-results" id="exerciseResults"></div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="exerciseName">ìš´ë™ ì´ë¦„:</label>
                        <input type="text" id="exerciseName" required>
                    </div>
                    <div class="form-group">
                        <label for="exerciseDuration">ìš´ë™ ì‹œê°„ (ë¶„):</label>
                        <input type="number" id="exerciseDuration" min="1" required>
                    </div>
                    <div class="form-group">
                        <label for="exerciseCalories">ì†Œëª¨ ì¹¼ë¡œë¦¬:</label>
                        <input type="number" id="exerciseCalories" readonly>
                    </div>
                    <button type="submit" class="btn">ìš´ë™ ê¸°ë¡ ì¶”ê°€</button>
                </form>
                
                <div class="records" id="exerciseRecords">
                    <h3>ì˜¤ëŠ˜ì˜ ìš´ë™ ê¸°ë¡</h3>
                </div>
            </div>

            <div class="section">
                <h2>ğŸ½ï¸ ì‹ë‹¨ ê¸°ë¡</h2>
                <form id="foodForm">
                    <div class="form-group">
                        <label for="foodSearch">ìŒì‹ ê²€ìƒ‰:</label>
                        <div class="search-container">
                            <input type="text" id="foodSearch" placeholder="ìŒì‹ ì´ë¦„ì„ ê²€ìƒ‰í•˜ì„¸ìš”">
                            <div class="search-results" id="foodResults"></div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="foodName">ìŒì‹ ì´ë¦„:</label>
                        <input type="text" id="foodName" required>
                    </div>
                    <div class="form-group">
                        <label for="foodAmount">ì–‘ (g):</label>
                        <input type="number" id="foodAmount" min="1" required>
                    </div>
                    <div class="form-group">
                        <label for="foodCalories">ì¹¼ë¡œë¦¬:</label>
                        <input type="number" id="foodCalories" min="0" step="0.1" placeholder="ìˆ˜ë™ ì…ë ¥ ê°€ëŠ¥">
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="foodCarbs">íƒ„ìˆ˜í™”ë¬¼ (g):</label>
                            <input type="number" id="foodCarbs" step="0.1" min="0" placeholder="ìˆ˜ë™ ì…ë ¥ ê°€ëŠ¥">
                        </div>
                        <div class="form-group">
                            <label for="foodProtein">ë‹¨ë°±ì§ˆ (g):</label>
                            <input type="number" id="foodProtein" step="0.1" min="0" placeholder="ìˆ˜ë™ ì…ë ¥ ê°€ëŠ¥">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="foodFat">ì§€ë°© (g):</label>
                        <input type="number" id="foodFat" step="0.1" min="0" placeholder="ìˆ˜ë™ ì…ë ¥ ê°€ëŠ¥">
                    </div>
                    
                    <div class="nutrition-scanner">
                        <h4>ğŸ“· ì˜ì–‘ì„±ë¶„í‘œ ìŠ¤ìº”</h4>
                        <p>ì œí’ˆ ì˜ì–‘ì„±ë¶„í‘œ ì‚¬ì§„ì„ ì—…ë¡œë“œí•˜ë©´ ìë™ìœ¼ë¡œ ì˜ì–‘ì†Œ ì •ë³´ë¥¼ ì…ë ¥í•´ë“œë¦½ë‹ˆë‹¤.</p>
                        <input type="file" id="nutritionImage" accept="image/*" style="display: none;">
                        <button type="button" class="scanner-button" onclick="selectNutritionImage()">ğŸ“· ì‚¬ì§„ ì„ íƒ</button>
                        <button type="button" class="scanner-button" id="analyzeBtn" onclick="analyzeNutritionImage()" disabled>ğŸ” ë¶„ì„ ì‹œì‘</button>
                        
                        <div id="imagePreview" style="display: none;">
                            <img id="previewImg" class="image-preview" alt="ì˜ì–‘ì„±ë¶„í‘œ ë¯¸ë¦¬ë³´ê¸°">
                        </div>
                        
                        <div id="analysisResult" class="analysis-result">
                            <div id="analysisContent"></div>
                        </div>
                    </div>
                    
                    <div class="web-search-section">
                        <h4>ğŸ” ì›¹ì—ì„œ ì¹¼ë¡œë¦¬ ê²€ìƒ‰</h4>
                        <p>ë°ì´í„°ë² ì´ìŠ¤ì— ì—†ëŠ” ìŒì‹ì˜ ì˜ì–‘ ì •ë³´ë¥¼ ì›¹ì—ì„œ ê²€ìƒ‰í•´ë“œë¦½ë‹ˆë‹¤.</p>
                        <div class="search-input-container">
                            <input type="text" id="webSearchInput" class="web-search-input" placeholder="ì˜ˆ: ì‚¼ê°ê¹€ë°¥ ì¹¼ë¡œë¦¬">
                            <button type="button" class="web-search-button" id="webSearchBtn" onclick="searchFoodNutrition()">ğŸ” ê²€ìƒ‰</button>
                        </div>
                        <div id="webSearchResults" class="web-search-results"></div>
                    </div>
                    <div class="form-group">
                        <label for="mealTime">ì‹ì‚¬ ì‹œê°„:</label>
                        <select id="mealTime">
                            <option value="breakfast">ì•„ì¹¨</option>
                            <option value="lunch">ì ì‹¬</option>
                            <option value="dinner">ì €ë…</option>
                            <option value="snack">ê°„ì‹</option>
                        </select>
                    </div>
                    <button type="submit" class="btn">ì‹ë‹¨ ê¸°ë¡ ì¶”ê°€</button>
                </form>
                
                <div class="records" id="foodRecords">
                    <h3>ì˜¤ëŠ˜ì˜ ì‹ë‹¨ ê¸°ë¡</h3>
                </div>
            </div>
        </div>

            <div class="summary">
            <h2>ğŸ“Š ì¼ì¼ ìš”ì•½</h2>
            <div class="summary-stats">
                <div class="stat-item">
                    <div class="stat-value" id="totalCaloriesConsumed">0</div>
                    <div class="stat-label">ì„­ì·¨ ì¹¼ë¡œë¦¬</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="totalCaloriesBurned">0</div>
                    <div class="stat-label">ì†Œëª¨ ì¹¼ë¡œë¦¬</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="netCalories">0</div>
                    <div class="stat-label">ìˆœ ì¹¼ë¡œë¦¬</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="totalExerciseTime">0</div>
                    <div class="stat-label">ìš´ë™ ì‹œê°„ (ë¶„)</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="totalCarbs">0</div>
                    <div class="stat-label">íƒ„ìˆ˜í™”ë¬¼ (g)</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="totalProtein">0</div>
                    <div class="stat-label">ë‹¨ë°±ì§ˆ (g)</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="totalFat">0</div>
                    <div class="stat-label">ì§€ë°© (g)</div>
                </div>
            </div>
            </div>
        </div>

        <div id="planTab" class="tab-content">
            <div class="main-content">
                <div class="section">
                    <h2>ğŸ“‹ ìš´ë™ ê³„íš ì‘ì„±</h2>
                    <form id="planForm">
                        <div class="form-group">
                            <label for="planExerciseSearch">ìš´ë™ ê²€ìƒ‰:</label>
                            <div class="search-container">
                                <input type="text" id="planExerciseSearch" placeholder="ìš´ë™ ì´ë¦„ì„ ê²€ìƒ‰í•˜ì„¸ìš”">
                                <div class="search-results" id="planExerciseResults"></div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="planExerciseName">ìš´ë™ ì´ë¦„:</label>
                            <input type="text" id="planExerciseName" required>
                        </div>
                        <div class="form-group">
                            <label for="planExerciseDuration">ê³„íš ì‹œê°„ (ë¶„):</label>
                            <input type="number" id="planExerciseDuration" min="1" required>
                        </div>
                        <div class="form-group">
                            <label for="planExerciseCalories">ì˜ˆìƒ ì†Œëª¨ ì¹¼ë¡œë¦¬:</label>
                            <input type="number" id="planExerciseCalories" readonly>
                        </div>
                        <button type="submit" class="btn">ê³„íš ì¶”ê°€</button>
                    </form>
                    
                    <div class="records" id="planRecords">
                        <h3>ì˜¤ëŠ˜ì˜ ìš´ë™ ê³„íš</h3>
                    </div>
                    
                    <div id="recommendationSection" class="recommendation-section" style="display: none;">
                        <h3>ğŸ¯ ëª©í‘œ ë‹¬ì„±ì„ ìœ„í•œ ìš´ë™ ì¶”ì²œ</h3>
                        <p>ì˜¤ëŠ˜ ìš´ë™ ê³„íšì´ ë¹„ì–´ìˆìŠµë‹ˆë‹¤. ëª©í‘œ ë‹¬ì„±ì„ ìœ„í•œ ë§ì¶¤í˜• ìš´ë™ì„ ì¶”ì²œí•´ë“œë¦´ê¹Œìš”?</p>
                        <button class="recommendation-button" onclick="getExerciseRecommendation()">ğŸ’ª ìš´ë™ ì¶”ì²œ ë°›ê¸°</button>
                        <div id="recommendationResult" class="recommendation-result" style="display: none;"></div>
                    </div>
                </div>

                <div class="section">
                    <h2>ğŸ¯ ê³„íš ìš”ì•½</h2>
                    <div class="summary-stats">
                        <div class="stat-item">
                            <div class="stat-value" id="plannedCalories">0</div>
                            <div class="stat-label">ê³„íšëœ ì†Œëª¨ ì¹¼ë¡œë¦¬</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="plannedTime">0</div>
                            <div class="stat-label">ê³„íšëœ ìš´ë™ ì‹œê°„ (ë¶„)</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="plannedExercises">0</div>
                            <div class="stat-label">ê³„íšëœ ìš´ë™ ìˆ˜</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="compareTab" class="tab-content">
            <div class="comparison-section">
                <h2>ğŸ“Š ê³„íš vs ì‹¤ì œ ë¹„êµ</h2>
                <div class="comparison-grid">
                    <div class="comparison-item planned">
                        <h3>ğŸ“‹ ê³„íš</h3>
                        <p>ì†Œëª¨ ì¹¼ë¡œë¦¬: <span id="comparePlannedCalories">0</span>kcal</p>
                        <p>ìš´ë™ ì‹œê°„: <span id="comparePlannedTime">0</span>ë¶„</p>
                        <p>ìš´ë™ ìˆ˜: <span id="comparePlannedCount">0</span>ê°œ</p>
                    </div>
                    <div class="comparison-item actual">
                        <h3>âœ… ì‹¤ì œ</h3>
                        <p>ì†Œëª¨ ì¹¼ë¡œë¦¬: <span id="compareActualCalories">0</span>kcal</p>
                        <p>ìš´ë™ ì‹œê°„: <span id="compareActualTime">0</span>ë¶„</p>
                        <p>ìš´ë™ ìˆ˜: <span id="compareActualCount">0</span>ê°œ</p>
                    </div>
                </div>
                
                <div style="margin-top: 20px;">
                    <h3>ğŸ¯ ë‹¬ì„±ë¥ </h3>
                    <div>
                        <span>ì¹¼ë¡œë¦¬ ë‹¬ì„±ë¥ : <span id="calorieAchievement">0%</span></span>
                        <span id="calorieBadge" class="achievement-badge"></span>
                        <div class="progress-bar">
                            <div class="progress-fill" id="calorieProgress"></div>
                        </div>
                    </div>
                    <div style="margin-top: 10px;">
                        <span>ì‹œê°„ ë‹¬ì„±ë¥ : <span id="timeAchievement">0%</span></span>
                        <span id="timeBadge" class="achievement-badge"></span>
                        <div class="progress-bar">
                            <div class="progress-fill" id="timeProgress"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="comparison-section">
                <h2>ğŸ“‹ ì„¸ë¶€ ìš´ë™ ë¹„êµ</h2>
                <div id="detailedComparison"></div>
            </div>
        </div>
    </div>

    <!-- ìš´ë™ ê¸°ë¡ ìˆ˜ì • ëª¨ë‹¬ -->
    <div id="editExerciseModal" class="edit-modal">
        <div class="edit-modal-content">
            <h3>âœï¸ ìš´ë™ ê¸°ë¡ ìˆ˜ì •</h3>
            <form id="editExerciseForm">
                <div class="edit-form-group">
                    <label for="editExerciseName">ìš´ë™ ì´ë¦„:</label>
                    <input type="text" id="editExerciseName" required>
                </div>
                <div class="edit-form-group">
                    <label for="editExerciseDuration">ìš´ë™ ì‹œê°„ (ë¶„):</label>
                    <input type="number" id="editExerciseDuration" min="1" required>
                </div>
                <div class="edit-form-group">
                    <label for="editExerciseCalories">ì†Œëª¨ ì¹¼ë¡œë¦¬:</label>
                    <input type="number" id="editExerciseCalories" readonly>
                </div>
                <div class="edit-form-actions">
                    <button type="button" class="edit-cancel-btn" onclick="closeEditExerciseModal()">ì·¨ì†Œ</button>
                    <button type="submit" class="edit-save-btn">ì €ì¥</button>
                </div>
            </form>
        </div>
    </div>

    <!-- ìš´ë™ ê³„íš ìˆ˜ì • ëª¨ë‹¬ -->
    <div id="editPlanModal" class="edit-modal">
        <div class="edit-modal-content">
            <h3>âœï¸ ìš´ë™ ê³„íš ìˆ˜ì •</h3>
            <form id="editPlanForm">
                <div class="edit-form-group">
                    <label for="editPlanExerciseName">ìš´ë™ ì´ë¦„:</label>
                    <input type="text" id="editPlanExerciseName" required>
                </div>
                <div class="edit-form-group">
                    <label for="editPlanExerciseDuration">ê³„íš ì‹œê°„ (ë¶„):</label>
                    <input type="number" id="editPlanExerciseDuration" min="1" required>
                </div>
                <div class="edit-form-group">
                    <label for="editPlanExerciseCalories">ì˜ˆìƒ ì†Œëª¨ ì¹¼ë¡œë¦¬:</label>
                    <input type="number" id="editPlanExerciseCalories" readonly>
                </div>
                <div class="edit-form-actions">
                    <button type="button" class="edit-cancel-btn" onclick="closeEditPlanModal()">ì·¨ì†Œ</button>
                    <button type="submit" class="edit-save-btn">ì €ì¥</button>
                </div>
            </form>
        </div>
    </div>

    <!-- ì‹ë‹¨ ê¸°ë¡ ìˆ˜ì • ëª¨ë‹¬ -->
    <div id="editFoodModal" class="edit-modal">
        <div class="edit-modal-content">
            <h3>âœï¸ ì‹ë‹¨ ê¸°ë¡ ìˆ˜ì •</h3>
            <form id="editFoodForm">
                <div class="edit-form-group">
                    <label for="editFoodName">ìŒì‹ ì´ë¦„:</label>
                    <input type="text" id="editFoodName" required>
                </div>
                <div class="edit-form-group">
                    <label for="editFoodAmount">ì–‘ (g):</label>
                    <input type="number" id="editFoodAmount" min="1" required>
                </div>
                <div class="edit-form-group">
                    <label for="editFoodCalories">ì¹¼ë¡œë¦¬:</label>
                    <input type="number" id="editFoodCalories" min="0" step="0.1" placeholder="ìˆ˜ë™ ì…ë ¥ ê°€ëŠ¥">
                </div>
                <div class="form-row">
                    <div class="edit-form-group">
                        <label for="editFoodCarbs">íƒ„ìˆ˜í™”ë¬¼ (g):</label>
                        <input type="number" id="editFoodCarbs" step="0.1" min="0" placeholder="ìˆ˜ë™ ì…ë ¥ ê°€ëŠ¥">
                    </div>
                    <div class="edit-form-group">
                        <label for="editFoodProtein">ë‹¨ë°±ì§ˆ (g):</label>
                        <input type="number" id="editFoodProtein" step="0.1" min="0" placeholder="ìˆ˜ë™ ì…ë ¥ ê°€ëŠ¥">
                    </div>
                </div>
                <div class="edit-form-group">
                    <label for="editFoodFat">ì§€ë°© (g):</label>
                    <input type="number" id="editFoodFat" step="0.1" min="0" placeholder="ìˆ˜ë™ ì…ë ¥ ê°€ëŠ¥">
                </div>
                <div class="edit-form-group">
                    <label for="editMealTime">ì‹ì‚¬ ì‹œê°„:</label>
                    <select id="editMealTime">
                        <option value="breakfast">ì•„ì¹¨</option>
                        <option value="lunch">ì ì‹¬</option>
                        <option value="dinner">ì €ë…</option>
                        <option value="snack">ê°„ì‹</option>
                    </select>
                </div>
                <div class="edit-form-actions">
                    <button type="button" class="edit-cancel-btn" onclick="closeEditFoodModal()">ì·¨ì†Œ</button>
                    <button type="submit" class="edit-save-btn">ì €ì¥</button>
                </div>
            </form>
        </div>
    </div>

    <!-- ê²©ë ¤ ë©”ì‹œì§€ ëª¨ë‹¬ -->
    <div id="encouragementModal" class="encouragement-modal">
        <div class="encouragement-modal-content">
            <div class="celebration-emoji" id="celebrationEmoji">ğŸ‰</div>
            <h2 id="encouragementTitle">ì¶•í•˜í•©ë‹ˆë‹¤!</h2>
            <div class="encouragement-message" id="encouragementMessage">
                ì˜¤ëŠ˜ë„ í˜ì°¨ê²Œ ìš´ë™í–ˆë„¤ìš”. ì˜í•˜ì…¨ìŠµë‹ˆë‹¤!
            </div>
            <div class="encouragement-stats" id="encouragementStats">
                <h4>ğŸ¯ ë‹¬ì„±í•œ ê³„íš</h4>
                <div id="achievementDetails"></div>
            </div>
            <button class="encouragement-ok-btn" onclick="closeEncouragementModal()">í™•ì¸</button>
        </div>
    </div>

    <!-- í”„ë¡œí•„ ì„¤ì • ëª¨ë‹¬ -->
    <div id="profileModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeProfileModal()">&times;</span>
            <h2>ğŸ‘¤ í”„ë¡œí•„ ì„¤ì •</h2>
            <p>ì •í™•í•œ ì¹¼ë¡œë¦¬ ê³„ì‚°ì„ ìœ„í•´ ê°œì¸ ì •ë³´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.</p>
            <form id="profileForm">
                <div class="form-row">
                    <div class="form-group">
                        <label for="userAge">ë‚˜ì´:</label>
                        <input type="number" id="userAge" min="10" max="100" required>
                    </div>
                    <div class="form-group">
                        <label for="userGender">ì„±ë³„:</label>
                        <select id="userGender" required>
                            <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                            <option value="male">ë‚¨ì„±</option>
                            <option value="female">ì—¬ì„±</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="userHeight">í‚¤ (cm):</label>
                        <input type="number" id="userHeight" min="100" max="250" required>
                    </div>
                    <div class="form-group">
                        <label for="userWeight">í˜„ì¬ ì²´ì¤‘ (kg):</label>
                        <input type="number" id="userWeight" min="30" max="200" step="0.1" required>
                    </div>
                </div>
                <div class="form-group">
                    <label for="targetWeight">ëª©í‘œ ì²´ì¤‘ (kg):</label>
                    <input type="number" id="targetWeight" min="30" max="200" step="0.1" required>
                </div>
                <div class="form-group">
                    <label for="weightGoal">ëª©í‘œ ìœ í˜•:</label>
                    <select id="weightGoal" required>
                        <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                        <option value="lose">ì²´ì¤‘ ê°ëŸ‰</option>
                        <option value="maintain">ì²´ì¤‘ ìœ ì§€</option>
                        <option value="gain">ì²´ì¤‘ ì¦ê°€</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="activityLevel">ì¼ìƒ í™œë™ ìˆ˜ì¤€:</label>
                    <select id="activityLevel" required>
                        <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                        <option value="sedentary">ì¢Œì‹ ìƒí™œ (ìš´ë™ ê±°ì˜ ì•ˆí•¨)</option>
                        <option value="light">ê°€ë²¼ìš´ í™œë™ (ì£¼ 1-3íšŒ ìš´ë™)</option>
                        <option value="moderate">ë³´í†µ í™œë™ (ì£¼ 3-5íšŒ ìš´ë™)</option>
                        <option value="active">í™œë°œí•œ í™œë™ (ì£¼ 6-7íšŒ ìš´ë™)</option>
                        <option value="very_active">ë§¤ìš° í™œë°œ (í•˜ë£¨ 2íšŒ ìš´ë™)</option>
                    </select>
                </div>
                <button type="submit" class="btn">í”„ë¡œí•„ ì €ì¥</button>
            </form>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@2.1.5/dist/tesseract.min.js"></script>
    <script>
        // MET ê°’ ê¸°ë°˜ ìš´ë™ ë°ì´í„°ë² ì´ìŠ¤ (Metabolic Equivalent of Task)
        const exerciseDatabase = {
            'ë‹¬ë¦¬ê¸°': { met: 8.0, description: 'ë³´í†µ ì†ë„ (8km/h)' },
            'ê±·ê¸°': { met: 3.5, description: 'ë³´í†µ ì†ë„ (5km/h)' },
            'ìì „ê±°': { met: 6.8, description: 'ë³´í†µ ì†ë„ (16km/h)' },
            'ìˆ˜ì˜': { met: 6.0, description: 'ììœ í˜• ë³´í†µ ì†ë„' },
            'ìš”ê°€': { met: 2.5, description: 'í•˜íƒ€ ìš”ê°€' },
            'í—¬ìŠ¤': { met: 6.0, description: 'ì›¨ì´íŠ¸ íŠ¸ë ˆì´ë‹' },
            'ë†êµ¬': { met: 8.0, description: 'ì¼ë°˜ ê²Œì„' },
            'ì¶•êµ¬': { met: 7.0, description: 'ì¼ë°˜ ê²Œì„' },
            'ë°°ë“œë¯¼í„´': { met: 5.5, description: 'ë ˆí¬ë¦¬ì—ì´ì…˜' },
            'í…Œë‹ˆìŠ¤': { met: 7.3, description: 'ì‹±ê¸€ ê²Œì„' },
            'ë“±ì‚°': { met: 7.3, description: 'í‰ê·  ê²½ì‚¬ë„' },
            'ìŠ¤ì¿¼íŠ¸': { met: 5.0, description: 'ì²´ì¤‘ ìš´ë™' },
            'íŒ”êµ½í˜€í´ê¸°': { met: 3.8, description: 'ì²´ì¤‘ ìš´ë™' },
            'í”Œë­í¬': { met: 3.3, description: 'ì •ì  ìš´ë™' },
            'ì¤„ë„˜ê¸°': { met: 11.0, description: 'ë³´í†µ ì†ë„' },
            'ì—ì–´ë¡œë¹…': { met: 6.5, description: 'ì €ê°•ë„' },
            'í•„ë¼í…ŒìŠ¤': { met: 3.0, description: 'ë§¤íŠ¸ ìš´ë™' },
            'íƒœê¶Œë„': { met: 10.3, description: 'ìŠ¤íŒŒë§' },
            'ë³µì‹±': { met: 9.5, description: 'ì¼ë°˜ ì—°ìŠµ' },
            'í¬ë¡œìŠ¤í•': { met: 10.5, description: 'ê³ ê°•ë„' }
        };

        const foodDatabase = {
            'ë°¥': { calories: 130, carbs: 28, protein: 2.7, fat: 0.3, per: 100 },
            'ê¹€ì¹˜': { calories: 18, carbs: 2.4, protein: 2.0, fat: 0.6, per: 100 },
            'ëœì¥ì°Œê°œ': { calories: 55, carbs: 6.2, protein: 4.8, fat: 1.8, per: 100 },
            'ë¶ˆê³ ê¸°': { calories: 280, carbs: 2.5, protein: 26.0, fat: 18.0, per: 100 },
            'ì¹˜í‚¨': { calories: 250, carbs: 0, protein: 25.0, fat: 16.0, per: 100 },
            'í”¼ì': { calories: 266, carbs: 33.0, protein: 11.0, fat: 10.0, per: 100 },
            'í–„ë²„ê±°': { calories: 295, carbs: 30.0, protein: 17.0, fat: 12.0, per: 100 },
            'ë¼ë©´': { calories: 380, carbs: 55.0, protein: 10.0, fat: 14.0, per: 100 },
            'ì‚¬ê³¼': { calories: 52, carbs: 14.0, protein: 0.3, fat: 0.2, per: 100 },
            'ë°”ë‚˜ë‚˜': { calories: 89, carbs: 23.0, protein: 1.1, fat: 0.3, per: 100 },
            'ìš°ìœ ': { calories: 42, carbs: 5.0, protein: 3.4, fat: 1.0, per: 100 },
            'ê³„ë€': { calories: 155, carbs: 1.1, protein: 13.0, fat: 11.0, per: 100 },
            'ë¹µ': { calories: 265, carbs: 49.0, protein: 9.0, fat: 4.2, per: 100 },
            'ìƒëŸ¬ë“œ': { calories: 20, carbs: 3.6, protein: 1.4, fat: 0.2, per: 100 },
            'ìŠ¤íŒŒê²Œí‹°': { calories: 131, carbs: 25.0, protein: 5.0, fat: 1.1, per: 100 },
            'ì´ˆì½œë¦¿': { calories: 546, carbs: 61.0, protein: 7.8, fat: 31.0, per: 100 },
            'ì•„ì´ìŠ¤í¬ë¦¼': { calories: 207, carbs: 24.0, protein: 3.5, fat: 11.0, per: 100 },
            'ì½œë¼': { calories: 42, carbs: 10.6, protein: 0, fat: 0, per: 100 },
            'ì»¤í”¼': { calories: 2, carbs: 0, protein: 0.3, fat: 0, per: 100 },
            'ë§¥ì£¼': { calories: 43, carbs: 3.6, protein: 0.5, fat: 0, per: 100 }
        };

        // ì˜¤ëŠ˜ ë‚ ì§œ ì„¤ì •
        const today = new Date().toISOString().split('T')[0];
        document.getElementById('recordDate').value = today;

        // ì‚¬ìš©ì í”„ë¡œí•„ ê´€ë¦¬
        function loadUserProfile() {
            const profile = JSON.parse(localStorage.getItem('userProfile'));
            if (profile) {
                document.getElementById('userAge').value = profile.age;
                document.getElementById('userGender').value = profile.gender;
                document.getElementById('userHeight').value = profile.height;
                document.getElementById('userWeight').value = profile.weight;
                document.getElementById('targetWeight').value = profile.targetWeight || '';
                document.getElementById('weightGoal').value = profile.weightGoal || '';
                document.getElementById('activityLevel').value = profile.activityLevel;
                displayProfileInfo(profile);
            }
        }

        function saveUserProfile() {
            const profile = {
                age: parseInt(document.getElementById('userAge').value),
                gender: document.getElementById('userGender').value,
                height: parseInt(document.getElementById('userHeight').value),
                weight: parseFloat(document.getElementById('userWeight').value),
                targetWeight: parseFloat(document.getElementById('targetWeight').value),
                weightGoal: document.getElementById('weightGoal').value,
                activityLevel: document.getElementById('activityLevel').value
            };
            localStorage.setItem('userProfile', JSON.stringify(profile));
            displayProfileInfo(profile);
            return profile;
        }

        function displayProfileInfo(profile) {
            const bmi = (profile.weight / Math.pow(profile.height / 100, 2)).toFixed(1);
            const bmr = calculateBMR(profile);
            const tdee = calculateTDEE(bmr, profile.activityLevel);
            
            let weightStatus = '';
            if (profile.targetWeight) {
                const weightDiff = profile.targetWeight - profile.weight;
                const weightGoalText = {
                    'lose': 'ê°ëŸ‰',
                    'maintain': 'ìœ ì§€', 
                    'gain': 'ì¦ê°€'
                };
                
                if (Math.abs(weightDiff) < 0.5) {
                    weightStatus = `<br>ğŸ¯ ëª©í‘œ ë‹¬ì„±! (ëª©í‘œ: ${profile.targetWeight}kg)`;
                } else {
                    const direction = weightDiff > 0 ? '+' : '';
                    weightStatus = `<br>ğŸ¯ ëª©í‘œ: ${profile.targetWeight}kg (${direction}${weightDiff.toFixed(1)}kg ${weightGoalText[profile.weightGoal] || ''})`;
                }
            }
            
            document.getElementById('profileDisplay').innerHTML = `
                ${profile.gender === 'male' ? 'ë‚¨ì„±' : 'ì—¬ì„±'}, ${profile.age}ì„¸, ${profile.height}cm, ${profile.weight}kg<br>
                BMI: ${bmi} | ê¸°ì´ˆëŒ€ì‚¬ìœ¨: ${bmr.toFixed(0)}kcal | ì¼ì¼ ì†Œëª¨: ${tdee.toFixed(0)}kcal${weightStatus}
            `;
            document.getElementById('profileInfo').style.display = 'block';
        }

        // ê¸°ì´ˆëŒ€ì‚¬ìœ¨ ê³„ì‚° (Harris-Benedict ê³µì‹)
        function calculateBMR(profile) {
            if (profile.gender === 'male') {
                return 88.362 + (13.397 * profile.weight) + (4.799 * profile.height) - (5.677 * profile.age);
            } else {
                return 447.593 + (9.247 * profile.weight) + (3.098 * profile.height) - (4.330 * profile.age);
            }
        }

        // ì¼ì¼ ì´ ì†Œëª¨ ì¹¼ë¡œë¦¬ ê³„ì‚° (TDEE)
        function calculateTDEE(bmr, activityLevel) {
            const activityMultipliers = {
                sedentary: 1.2,
                light: 1.375,
                moderate: 1.55,
                active: 1.725,
                very_active: 1.9
            };
            return bmr * activityMultipliers[activityLevel];
        }

        // ê°œì¸í™”ëœ ì¹¼ë¡œë¦¬ ê³„ì‚° (MET ê³µì‹: METs Ã— ì²´ì¤‘(kg) Ã— ì‹œê°„(ì‹œê°„))
        function calculatePersonalizedCalories(exercise, duration) {
            const profile = JSON.parse(localStorage.getItem('userProfile'));
            if (!profile || !exerciseDatabase[exercise]) {
                return exerciseDatabase[exercise] ? exerciseDatabase[exercise].met * 70 * (duration / 60) : 0;
            }
            
            const met = exerciseDatabase[exercise].met;
            const weight = profile.weight;
            const hours = duration / 60;
            
            return Math.round(met * weight * hours);
        }

        // ëª¨ë‹¬ ê´€ë¦¬
        function openProfileModal() {
            document.getElementById('profileModal').style.display = 'block';
            document.getElementById('profileModal').dataset.editing = 'false';
            // ìƒˆë¡œìš´ í”„ë¡œí•„ ì‘ì„±ì‹œ í¼ ì´ˆê¸°í™”
            document.getElementById('profileForm').reset();
        }

        function editProfile() {
            const profile = JSON.parse(localStorage.getItem('userProfile'));
            if (!profile) {
                alert('ìˆ˜ì •í•  í”„ë¡œí•„ì´ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            // ëª¨ë‹¬ì— ê¸°ì¡´ ë°ì´í„° ì±„ìš°ê¸°
            document.getElementById('userAge').value = profile.age;
            document.getElementById('userGender').value = profile.gender;
            document.getElementById('userHeight').value = profile.height;
            document.getElementById('userWeight').value = profile.weight;
            document.getElementById('targetWeight').value = profile.targetWeight || '';
            document.getElementById('weightGoal').value = profile.weightGoal || '';
            document.getElementById('activityLevel').value = profile.activityLevel;
            
            // ìˆ˜ì • ëª¨ë“œë¡œ ì„¤ì •
            document.getElementById('profileModal').dataset.editing = 'true';
            document.getElementById('profileModal').style.display = 'block';
            
            // ëª¨ë‹¬ ì œëª© ë³€ê²½
            document.querySelector('#profileModal h2').textContent = 'ğŸ‘¤ í”„ë¡œí•„ ìˆ˜ì •';
        }

        function closeProfileModal() {
            document.getElementById('profileModal').style.display = 'none';
            document.getElementById('profileModal').dataset.editing = 'false';
            // ëª¨ë‹¬ ì œëª© ì›ë˜ëŒ€ë¡œ ë³µêµ¬
            document.querySelector('#profileModal h2').textContent = 'ğŸ‘¤ í”„ë¡œí•„ ì„¤ì •';
        }

        // í”„ë¡œí•„ í¼ ì œì¶œ
        document.getElementById('profileForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const isEditing = document.getElementById('profileModal').dataset.editing === 'true';
            saveUserProfile();
            closeProfileModal();
            
            if (isEditing) {
                alert('í”„ë¡œí•„ì´ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤! ë³€ê²½ëœ ì •ë³´ì— ë”°ë¼ ì¹¼ë¡œë¦¬ ê³„ì‚°ì´ ì—…ë°ì´íŠ¸ë©ë‹ˆë‹¤.');
                // í”„ë¡œí•„ ìˆ˜ì • í›„ í™”ë©´ ì—…ë°ì´íŠ¸
                refreshAfterProfileUpdate();
                // ì¶”ì²œ ìš´ë™ ì¬ê²€í† 
                checkAndShowRecommendations();
            } else {
                alert('í”„ë¡œí•„ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤! ì´ì œ ë” ì •í™•í•œ ì¹¼ë¡œë¦¬ ê³„ì‚°ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
            }
        });

        // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
        window.onclick = function(event) {
            const modal = document.getElementById('profileModal');
            if (event.target === modal) {
                closeProfileModal();
            }
        };

        // í”„ë¡œí•„ ìˆ˜ì • í›„ í™”ë©´ ì—…ë°ì´íŠ¸
        function refreshAfterProfileUpdate() {
            // ëª¨ë“  ìš´ë™ ì¹¼ë¡œë¦¬ ì¬ê³„ì‚° (ì´ë¯¸ ê¸°ë¡ëœ ê²ƒë“¤ì„ ìƒˆë¡œìš´ í”„ë¡œí•„ë¡œ ì—…ë°ì´íŠ¸)
            const selectedDate = document.getElementById('recordDate').value;
            const exercises = JSON.parse(localStorage.getItem(`exercises_${selectedDate}`)) || [];
            const plans = JSON.parse(localStorage.getItem(`plans_${selectedDate}`)) || [];
            
            // ê¸°ì¡´ ìš´ë™ ê¸°ë¡ì˜ ì¹¼ë¡œë¦¬ ì¬ê³„ì‚°
            exercises.forEach(exercise => {
                exercise.calories = calculatePersonalizedCalories(exercise.name, exercise.duration);
            });
            
            // ê¸°ì¡´ ìš´ë™ ê³„íšì˜ ì¹¼ë¡œë¦¬ ì¬ê³„ì‚°
            plans.forEach(plan => {
                plan.calories = calculatePersonalizedCalories(plan.name, plan.duration);
            });
            
            // ì—…ë°ì´íŠ¸ëœ ë°ì´í„° ì €ì¥
            localStorage.setItem(`exercises_${selectedDate}`, JSON.stringify(exercises));
            localStorage.setItem(`plans_${selectedDate}`, JSON.stringify(plans));
            
            // í™”ë©´ ìƒˆë¡œê³ ì¹¨
            loadData();
            
            // ë¹„êµ íƒ­ì´ í™œì„±í™”ë˜ì–´ ìˆë‹¤ë©´ ì—…ë°ì´íŠ¸
            if (document.getElementById('compareTab').classList.contains('active')) {
                updateComparison();
            }
        }

        // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ì„œ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
        function loadData() {
            const selectedDate = document.getElementById('recordDate').value;
            const exercises = JSON.parse(localStorage.getItem(`exercises_${selectedDate}`)) || [];
            const foods = JSON.parse(localStorage.getItem(`foods_${selectedDate}`)) || [];
            
            displayExercises(exercises);
            displayFoods(foods);
            updateSummary(exercises, foods);
        }

        // ìš´ë™ ê²€ìƒ‰ ê¸°ëŠ¥
        document.getElementById('exerciseSearch').addEventListener('input', function(e) {
            const query = e.target.value.toLowerCase();
            const results = document.getElementById('exerciseResults');
            
            if (query.length === 0) {
                results.style.display = 'none';
                return;
            }
            
            const matches = Object.keys(exerciseDatabase).filter(exercise => 
                exercise.toLowerCase().includes(query)
            );
            
            if (matches.length > 0) {
                results.innerHTML = matches.map(exercise => 
                    `<div class="search-item" onclick="selectExercise('${exercise}')">${exercise} (MET: ${exerciseDatabase[exercise].met})</div>`
                ).join('');
                results.style.display = 'block';
            } else {
                results.style.display = 'none';
            }
        });

        // ìŒì‹ ê²€ìƒ‰ ê¸°ëŠ¥
        document.getElementById('foodSearch').addEventListener('input', function(e) {
            const query = e.target.value.toLowerCase();
            const results = document.getElementById('foodResults');
            
            if (query.length === 0) {
                results.style.display = 'none';
                return;
            }
            
            const matches = Object.keys(foodDatabase).filter(food => 
                food.toLowerCase().includes(query)
            );
            
            if (matches.length > 0) {
                results.innerHTML = matches.map(food => 
                    `<div class="search-item" onclick="selectFood('${food}')">${food} (${foodDatabase[food].calories}cal | íƒ„${foodDatabase[food].carbs}g ë‹¨${foodDatabase[food].protein}g ì§€${foodDatabase[food].fat}g)</div>`
                ).join('');
                results.style.display = 'block';
            } else {
                results.style.display = 'none';
            }
        });

        // ìš´ë™ ì„ íƒ
        function selectExercise(exercise) {
            document.getElementById('exerciseName').value = exercise;
            document.getElementById('exerciseSearch').value = exercise;
            document.getElementById('exerciseResults').style.display = 'none';
            calculateExerciseCalories();
        }

        // ìŒì‹ ì„ íƒ
        function selectFood(food) {
            document.getElementById('foodName').value = food;
            document.getElementById('foodSearch').value = food;
            document.getElementById('foodResults').style.display = 'none';
            calculateFoodCalories();
        }

        // ìš´ë™ ì¹¼ë¡œë¦¬ ê³„ì‚° (ê°œì¸í™”ëœ ê³„ì‚°)
        function calculateExerciseCalories() {
            const exerciseName = document.getElementById('exerciseName').value;
            const duration = parseInt(document.getElementById('exerciseDuration').value) || 0;
            
            if (exerciseName in exerciseDatabase) {
                const calories = calculatePersonalizedCalories(exerciseName, duration);
                document.getElementById('exerciseCalories').value = calories;
            }
        }

        // ìŒì‹ ì¹¼ë¡œë¦¬ ë° ì˜ì–‘ì†Œ ê³„ì‚°
        function calculateFoodCalories() {
            const foodName = document.getElementById('foodName').value;
            const amount = parseInt(document.getElementById('foodAmount').value) || 0;
            
            if (foodName in foodDatabase) {
                const food = foodDatabase[foodName];
                const ratio = amount / 100;
                
                const calories = Math.round(food.calories * ratio);
                const carbs = Math.round(food.carbs * ratio * 10) / 10;
                const protein = Math.round(food.protein * ratio * 10) / 10;
                const fat = Math.round(food.fat * ratio * 10) / 10;
                
                document.getElementById('foodCalories').value = calories;
                document.getElementById('foodCarbs').value = carbs;
                document.getElementById('foodProtein').value = protein;
                document.getElementById('foodFat').value = fat;
            }
        }

        // ìš´ë™ ì‹œê°„ ì…ë ¥ì‹œ ì¹¼ë¡œë¦¬ ì¬ê³„ì‚°
        document.getElementById('exerciseDuration').addEventListener('input', calculateExerciseCalories);

        // ìŒì‹ ì–‘ ì…ë ¥ì‹œ ì¹¼ë¡œë¦¬ ì¬ê³„ì‚°
        document.getElementById('foodAmount').addEventListener('input', calculateFoodCalories);

        // ìš´ë™ ê¸°ë¡ ì¶”ê°€
        document.getElementById('exerciseForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const selectedDate = document.getElementById('recordDate').value;
            const exercise = {
                name: document.getElementById('exerciseName').value,
                duration: parseInt(document.getElementById('exerciseDuration').value),
                calories: parseInt(document.getElementById('exerciseCalories').value),
                timestamp: new Date().toLocaleTimeString()
            };
            
            const exercises = JSON.parse(localStorage.getItem(`exercises_${selectedDate}`)) || [];
            exercises.push(exercise);
            localStorage.setItem(`exercises_${selectedDate}`, JSON.stringify(exercises));
            
            displayExercises(exercises);
            updateSummary(exercises, JSON.parse(localStorage.getItem(`foods_${selectedDate}`)) || []);
            
            // í¼ ì´ˆê¸°í™”
            this.reset();
            document.getElementById('exerciseCalories').value = '';
        });

        // ì‹ë‹¨ ê¸°ë¡ ì¶”ê°€
        document.getElementById('foodForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const selectedDate = document.getElementById('recordDate').value;
            const food = {
                name: document.getElementById('foodName').value,
                amount: parseInt(document.getElementById('foodAmount').value),
                calories: parseInt(document.getElementById('foodCalories').value),
                carbs: parseFloat(document.getElementById('foodCarbs').value) || 0,
                protein: parseFloat(document.getElementById('foodProtein').value) || 0,
                fat: parseFloat(document.getElementById('foodFat').value) || 0,
                mealTime: document.getElementById('mealTime').value,
                timestamp: new Date().toLocaleTimeString()
            };
            
            const foods = JSON.parse(localStorage.getItem(`foods_${selectedDate}`)) || [];
            foods.push(food);
            localStorage.setItem(`foods_${selectedDate}`, JSON.stringify(foods));
            
            displayFoods(foods);
            updateSummary(JSON.parse(localStorage.getItem(`exercises_${selectedDate}`)) || [], foods);
            
            // í¼ ì´ˆê¸°í™”
            this.reset();
            document.getElementById('foodCalories').value = '';
            document.getElementById('foodCarbs').value = '';
            document.getElementById('foodProtein').value = '';
            document.getElementById('foodFat').value = '';
        });

        // ìš´ë™ ê¸°ë¡ í‘œì‹œ
        function displayExercises(exercises) {
            const container = document.getElementById('exerciseRecords');
            container.innerHTML = '<h3>ì˜¤ëŠ˜ì˜ ìš´ë™ ê¸°ë¡</h3>';
            
            exercises.forEach((exercise, index) => {
                const div = document.createElement('div');
                div.className = 'record-item';
                div.innerHTML = `
                    <div class="record-info">
                        <strong>${exercise.name}</strong> - ${exercise.duration}ë¶„
                        <br><small>${exercise.timestamp}</small>
                    </div>
                    <div class="record-calories">${exercise.calories} cal</div>
                    <div class="record-actions">
                        <button class="edit-record-btn" onclick="editExercise(${index})">âœï¸ ìˆ˜ì •</button>
                        <button class="btn btn-danger" onclick="deleteExercise(${index})">ì‚­ì œ</button>
                    </div>
                `;
                container.appendChild(div);
            });
        }

        // ì‹ë‹¨ ê¸°ë¡ í‘œì‹œ
        function displayFoods(foods) {
            const container = document.getElementById('foodRecords');
            container.innerHTML = '<h3>ì˜¤ëŠ˜ì˜ ì‹ë‹¨ ê¸°ë¡</h3>';
            
            foods.forEach((food, index) => {
                const div = document.createElement('div');
                div.className = 'record-item';
                div.innerHTML = `
                    <div class="record-info">
                        <strong>${food.name}</strong> - ${food.amount}g (${food.mealTime})
                        <br><small>${food.timestamp}</small>
                        <br><small>íƒ„ìˆ˜í™”ë¬¼: ${food.carbs || 0}g | ë‹¨ë°±ì§ˆ: ${food.protein || 0}g | ì§€ë°©: ${food.fat || 0}g</small>
                    </div>
                    <div class="record-calories">${food.calories} cal</div>
                    <div class="record-actions">
                        <button class="edit-record-btn" onclick="editFood(${index})">âœï¸ ìˆ˜ì •</button>
                        <button class="btn btn-danger" onclick="deleteFood(${index})">ì‚­ì œ</button>
                    </div>
                `;
                container.appendChild(div);
            });
        }

        // ìš”ì•½ ì •ë³´ ì—…ë°ì´íŠ¸
        function updateSummary(exercises, foods) {
            const totalCaloriesBurned = exercises.reduce((sum, ex) => sum + ex.calories, 0);
            const totalCaloriesConsumed = foods.reduce((sum, food) => sum + food.calories, 0);
            const netCalories = totalCaloriesConsumed - totalCaloriesBurned;
            const totalExerciseTime = exercises.reduce((sum, ex) => sum + ex.duration, 0);
            
            // ì˜ì–‘ì†Œ ì´í•©
            const totalCarbs = foods.reduce((sum, food) => sum + (food.carbs || 0), 0);
            const totalProtein = foods.reduce((sum, food) => sum + (food.protein || 0), 0);
            const totalFat = foods.reduce((sum, food) => sum + (food.fat || 0), 0);
            
            document.getElementById('totalCaloriesConsumed').textContent = totalCaloriesConsumed;
            document.getElementById('totalCaloriesBurned').textContent = totalCaloriesBurned;
            document.getElementById('netCalories').textContent = netCalories;
            document.getElementById('totalExerciseTime').textContent = totalExerciseTime;
            
            // ì˜ì–‘ì†Œ í‘œì‹œ ì—…ë°ì´íŠ¸
            document.getElementById('totalCarbs').textContent = Math.round(totalCarbs * 10) / 10;
            document.getElementById('totalProtein').textContent = Math.round(totalProtein * 10) / 10;
            document.getElementById('totalFat').textContent = Math.round(totalFat * 10) / 10;
        }

        // ìš´ë™ ê¸°ë¡ ì‚­ì œ
        function deleteExercise(index) {
            const selectedDate = document.getElementById('recordDate').value;
            const exercises = JSON.parse(localStorage.getItem(`exercises_${selectedDate}`)) || [];
            exercises.splice(index, 1);
            localStorage.setItem(`exercises_${selectedDate}`, JSON.stringify(exercises));
            
            displayExercises(exercises);
            updateSummary(exercises, JSON.parse(localStorage.getItem(`foods_${selectedDate}`)) || []);
        }

        // ì‹ë‹¨ ê¸°ë¡ ì‚­ì œ
        function deleteFood(index) {
            const selectedDate = document.getElementById('recordDate').value;
            const foods = JSON.parse(localStorage.getItem(`foods_${selectedDate}`)) || [];
            foods.splice(index, 1);
            localStorage.setItem(`foods_${selectedDate}`, JSON.stringify(foods));
            
            displayFoods(foods);
            updateSummary(JSON.parse(localStorage.getItem(`exercises_${selectedDate}`)) || [], foods);
        }

        // ë‚ ì§œ ë³€ê²½ì‹œ ë°ì´í„° ë‹¤ì‹œ ë¡œë“œ
        document.getElementById('recordDate').addEventListener('change', loadData);

        // ê²€ìƒ‰ ê²°ê³¼ ì™¸ë¶€ í´ë¦­ì‹œ ìˆ¨ê¸°ê¸°
        document.addEventListener('click', function(e) {
            if (!e.target.closest('.search-container')) {
                document.getElementById('exerciseResults').style.display = 'none';
                document.getElementById('foodResults').style.display = 'none';
                document.getElementById('planExerciseResults').style.display = 'none';
            }
        });

        // íƒ­ ê´€ë¦¬
        function showTab(tabName) {
            // ëª¨ë“  íƒ­ ë²„íŠ¼ ë¹„í™œì„±í™”
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
            // ëª¨ë“  íƒ­ ë‚´ìš© ìˆ¨ê¸°ê¸°
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            // ì„ íƒëœ íƒ­ í™œì„±í™”
            event.target.classList.add('active');
            document.getElementById(tabName + 'Tab').classList.add('active');
            
            // íƒ­ ë³€ê²½ ì‹œ ë°ì´í„° ìƒˆë¡œê³ ì¹¨
            if (tabName === 'compare') {
                updateComparison();
            }
        }

        // ìš´ë™ ê³„íš ê´€ë¦¬
        function loadPlans() {
            const selectedDate = document.getElementById('recordDate').value;
            const plans = JSON.parse(localStorage.getItem(`plans_${selectedDate}`)) || [];
            displayPlans(plans);
            updatePlanSummary(plans);
            return plans;
        }

        function savePlan(plan) {
            const selectedDate = document.getElementById('recordDate').value;
            const plans = JSON.parse(localStorage.getItem(`plans_${selectedDate}`)) || [];
            plans.push(plan);
            localStorage.setItem(`plans_${selectedDate}`, JSON.stringify(plans));
            return plans;
        }

        function deletePlan(index) {
            const selectedDate = document.getElementById('recordDate').value;
            const plans = JSON.parse(localStorage.getItem(`plans_${selectedDate}`)) || [];
            plans.splice(index, 1);
            localStorage.setItem(`plans_${selectedDate}`, JSON.stringify(plans));
            displayPlans(plans);
            updatePlanSummary(plans);
        }

        function displayPlans(plans) {
            const container = document.getElementById('planRecords');
            container.innerHTML = '<h3>ì˜¤ëŠ˜ì˜ ìš´ë™ ê³„íš</h3>';
            
            plans.forEach((plan, index) => {
                const div = document.createElement('div');
                div.className = 'plan-item';
                
                // ì‹¤ì œ ìš´ë™ ê¸°ë¡ê³¼ ë¹„êµí•˜ì—¬ ìƒíƒœ í™•ì¸
                const exercises = JSON.parse(localStorage.getItem(`exercises_${document.getElementById('recordDate').value}`)) || [];
                const matchingExercise = exercises.find(ex => ex.name === plan.name);
                
                let status = 'pending';
                let statusText = 'ë¯¸ì™„ë£Œ';
                if (matchingExercise) {
                    if (matchingExercise.duration >= plan.duration) {
                        status = 'completed';
                        statusText = 'ì™„ë£Œ';
                    } else {
                        status = 'partial';
                        statusText = 'ë¶€ë¶„ì™„ë£Œ';
                    }
                }
                
                div.innerHTML = `
                    <div class="plan-info">
                        <strong>${plan.name}</strong> - ${plan.duration}ë¶„ (${plan.calories}kcal)
                        <br><small>ê³„íš ì‹œê°„: ${plan.timestamp}</small>
                    </div>
                    <div class="plan-status ${status}">${statusText}</div>
                    <div class="record-actions">
                        <button class="edit-record-btn" onclick="editPlan(${index})">âœï¸ ìˆ˜ì •</button>
                        <button class="btn btn-danger" onclick="deletePlan(${index})">ì‚­ì œ</button>
                    </div>
                `;
                container.appendChild(div);
            });
        }

        function updatePlanSummary(plans) {
            const totalCalories = plans.reduce((sum, plan) => sum + plan.calories, 0);
            const totalTime = plans.reduce((sum, plan) => sum + plan.duration, 0);
            const totalExercises = plans.length;
            
            document.getElementById('plannedCalories').textContent = totalCalories;
            document.getElementById('plannedTime').textContent = totalTime;
            document.getElementById('plannedExercises').textContent = totalExercises;
        }

        // ê³„íš vs ì‹¤ì œ ë¹„êµ
        function updateComparison() {
            const selectedDate = document.getElementById('recordDate').value;
            const plans = JSON.parse(localStorage.getItem(`plans_${selectedDate}`)) || [];
            const exercises = JSON.parse(localStorage.getItem(`exercises_${selectedDate}`)) || [];
            
            // ê³„íš ë°ì´í„°
            const plannedCalories = plans.reduce((sum, plan) => sum + plan.calories, 0);
            const plannedTime = plans.reduce((sum, plan) => sum + plan.duration, 0);
            const plannedCount = plans.length;
            
            // ì‹¤ì œ ë°ì´í„°
            const actualCalories = exercises.reduce((sum, ex) => sum + ex.calories, 0);
            const actualTime = exercises.reduce((sum, ex) => sum + ex.duration, 0);
            const actualCount = exercises.length;
            
            // ë¹„êµ í‘œì‹œ
            document.getElementById('comparePlannedCalories').textContent = plannedCalories;
            document.getElementById('comparePlannedTime').textContent = plannedTime;
            document.getElementById('comparePlannedCount').textContent = plannedCount;
            
            document.getElementById('compareActualCalories').textContent = actualCalories;
            document.getElementById('compareActualTime').textContent = actualTime;
            document.getElementById('compareActualCount').textContent = actualCount;
            
            // ë‹¬ì„±ë¥  ê³„ì‚°
            const calorieAchievement = plannedCalories > 0 ? Math.round((actualCalories / plannedCalories) * 100) : 0;
            const timeAchievement = plannedTime > 0 ? Math.round((actualTime / plannedTime) * 100) : 0;
            
            document.getElementById('calorieAchievement').textContent = calorieAchievement + '%';
            document.getElementById('timeAchievement').textContent = timeAchievement + '%';
            
            // ì§„í–‰ë¥  ë°”
            document.getElementById('calorieProgress').style.width = Math.min(calorieAchievement, 100) + '%';
            document.getElementById('timeProgress').style.width = Math.min(timeAchievement, 100) + '%';
            
            // ë±ƒì§€ í‘œì‹œ
            updateAchievementBadge('calorieBadge', calorieAchievement);
            updateAchievementBadge('timeBadge', timeAchievement);
            
            // ì„¸ë¶€ ë¹„êµ
            updateDetailedComparison(plans, exercises);
        }

        function updateAchievementBadge(elementId, percentage) {
            const badge = document.getElementById(elementId);
            if (percentage >= 90) {
                badge.className = 'achievement-badge excellent';
                badge.textContent = 'í›Œë¥­í•¨';
            } else if (percentage >= 70) {
                badge.className = 'achievement-badge good';
                badge.textContent = 'ì–‘í˜¸';
            } else {
                badge.className = 'achievement-badge needs-improvement';
                badge.textContent = 'ê°œì„ í•„ìš”';
            }
        }

        function updateDetailedComparison(plans, exercises) {
            const container = document.getElementById('detailedComparison');
            container.innerHTML = '';
            
            plans.forEach(plan => {
                const matchingExercise = exercises.find(ex => ex.name === plan.name);
                const div = document.createElement('div');
                div.className = 'comparison-item';
                
                if (matchingExercise) {
                    const timeDiff = matchingExercise.duration - plan.duration;
                    const calorieDiff = matchingExercise.calories - plan.calories;
                    
                    div.innerHTML = `
                        <h4>${plan.name}</h4>
                        <p>ê³„íš: ${plan.duration}ë¶„, ${plan.calories}kcal</p>
                        <p>ì‹¤ì œ: ${matchingExercise.duration}ë¶„, ${matchingExercise.calories}kcal</p>
                        <p>ì°¨ì´: ${timeDiff >= 0 ? '+' : ''}${timeDiff}ë¶„, ${calorieDiff >= 0 ? '+' : ''}${calorieDiff}kcal</p>
                    `;
                    div.style.borderLeftColor = timeDiff >= 0 ? '#27ae60' : '#e74c3c';
                } else {
                    div.innerHTML = `
                        <h4>${plan.name}</h4>
                        <p>ê³„íš: ${plan.duration}ë¶„, ${plan.calories}kcal</p>
                        <p style="color: #e74c3c;">ì‹¤ì œ: ë¯¸ì™„ë£Œ</p>
                    `;
                    div.style.borderLeftColor = '#e74c3c';
                }
                
                container.appendChild(div);
            });
        }

        // ê³„íš í¼ ì´ë²¤íŠ¸
        document.getElementById('planForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const plan = {
                name: document.getElementById('planExerciseName').value,
                duration: parseInt(document.getElementById('planExerciseDuration').value),
                calories: parseInt(document.getElementById('planExerciseCalories').value),
                timestamp: new Date().toLocaleTimeString()
            };
            
            const plans = savePlan(plan);
            displayPlans(plans);
            updatePlanSummary(plans);
            
            // í¼ ì´ˆê¸°í™”
            this.reset();
            document.getElementById('planExerciseCalories').value = '';
        });

        // ê³„íš ìš´ë™ ê²€ìƒ‰
        document.getElementById('planExerciseSearch').addEventListener('input', function(e) {
            const query = e.target.value.toLowerCase();
            const results = document.getElementById('planExerciseResults');
            
            if (query.length === 0) {
                results.style.display = 'none';
                return;
            }
            
            const matches = Object.keys(exerciseDatabase).filter(exercise => 
                exercise.toLowerCase().includes(query)
            );
            
            if (matches.length > 0) {
                results.innerHTML = matches.map(exercise => 
                    `<div class="search-item" onclick="selectPlanExercise('${exercise}')">${exercise} (MET: ${exerciseDatabase[exercise].met})</div>`
                ).join('');
                results.style.display = 'block';
            } else {
                results.style.display = 'none';
            }
        });

        // ê³„íš ìš´ë™ ì„ íƒ
        function selectPlanExercise(exercise) {
            document.getElementById('planExerciseName').value = exercise;
            document.getElementById('planExerciseSearch').value = exercise;
            document.getElementById('planExerciseResults').style.display = 'none';
            calculatePlanExerciseCalories();
        }

        // ê³„íš ìš´ë™ ì¹¼ë¡œë¦¬ ê³„ì‚°
        function calculatePlanExerciseCalories() {
            const exerciseName = document.getElementById('planExerciseName').value;
            const duration = parseInt(document.getElementById('planExerciseDuration').value) || 0;
            
            if (exerciseName in exerciseDatabase) {
                const calories = calculatePersonalizedCalories(exerciseName, duration);
                document.getElementById('planExerciseCalories').value = calories;
            }
        }

        // ê³„íš ìš´ë™ ì‹œê°„ ì…ë ¥ì‹œ ì¹¼ë¡œë¦¬ ì¬ê³„ì‚°
        document.getElementById('planExerciseDuration').addEventListener('input', calculatePlanExerciseCalories);

        // ìš´ë™ ì¶”ì²œ ì‹œìŠ¤í…œ
        function getExerciseRecommendation() {
            const profile = JSON.parse(localStorage.getItem('userProfile'));
            if (!profile || !profile.targetWeight) {
                alert('ë°”ë¥¸ ì¶”ì²œì„ ìœ„í•´ ë¨¼ì € í”„ë¡œí•„ì„ ì„¤ì •í•´ì£¼ì„¸ìš”!');
                return;
            }

            const recommendations = generateExerciseRecommendations(profile);
            displayRecommendations(recommendations, profile);
        }

        function generateExerciseRecommendations(profile) {
            const weightDiff = profile.targetWeight - profile.weight;
            const isWeightLoss = weightDiff < 0;
            const isWeightGain = weightDiff > 0;
            const isMaintenance = Math.abs(weightDiff) < 0.5;

            let recommendations = [];
            
            if (isWeightLoss) {
                // ì²´ì¤‘ ê°ëŸ‰ì„ ìœ„í•œ ìš´ë™
                recommendations = [
                    { exercise: 'ë‹¬ë¦¬ê¸°', duration: 30, reason: 'ì§€ë°© ì—°ì†Œì— íš¨ê³¼ì ì¸ ìœ ì‚°ì†Œ ìš´ë™' },
                    { exercise: 'ë¹ ë¥¸ ê±¸ê¸°', duration: 45, reason: 'ë¶€ë‹´ì´ ì ìœ¼ë©° ì§€ì†ê°€ëŠ¥í•œ ìš´ë™' },
                    { exercise: 'ìˆ˜ì˜', duration: 30, reason: 'ì „ì‹  ìš´ë™ìœ¼ë¡œ ì¹¼ë¡œë¦¬ ì†Œëª¨ëŸ‰ì´ ë†’ìŒ' },
                    { exercise: 'ì¤„ë„˜ê¸°', duration: 20, reason: 'ì§§ì€ ì‹œê°„ì— ë†’ì€ ì¹¼ë¡œë¦¬ ì†Œëª¨' }
                ];
            } else if (isWeightGain) {
                // ì²´ì¤‘ ì¦ê°€ë¥¼ ìœ„í•œ ìš´ë” (ê·¼ë ¥ ìš´ë™ ì¤‘ì‹¬)
                recommendations = [
                    { exercise: 'í—¬ìŠ¤', duration: 45, reason: 'ê·¼ë ¥ ì¦ê°€ì™€ ê±´ê°•í•œ ì²´ì¤‘ ì¦ê°€ì— ë„ì›€' },
                    { exercise: 'ìŠ¤ì¿¼íŠ¸', duration: 30, reason: 'í•˜ì²´ ê·¼ë ¥ ê°•í™”ì™€ ê¸°ì´ˆëŒ€ì‚¬ìœ¨ ì¦ê°€' },
                    { exercise: 'íŒ”êµ½í˜€í´ê¸°', duration: 15, reason: 'ìƒì²´ ê·¼ë ¥ ê°•í™”ì™€ ê·¼ìœ¡ëŸ‰ ì¦ê°€' },
                    { exercise: 'ìš”ê°€', duration: 30, reason: 'ìœ ì—°ì„±ê³¼ ê· í˜•ê°ê° í–¥ìƒ' }
                ];
            } else {
                // ì²´ì¤‘ ìœ ì§€ë¥¼ ìœ„í•œ ìš´ë™
                recommendations = [
                    { exercise: 'ë¹ ë¥¸ ê±¸ê¸°', duration: 30, reason: 'ì‹¬íê¸°ëŠ¥ ìœ ì§€ì™€ ê¸°ì´ˆì²´ë ¥ ê°•í™”' },
                    { exercise: 'ìš”ê°€', duration: 30, reason: 'ìœ ì—°ì„±ê³¼ ìŠ¤íŠ¸ë ˆìŠ¤ ê´€ë¦¬ì— ë„ì›€' },
                    { exercise: 'ì—ì–´ë¡œë¹…', duration: 30, reason: 'ì „ì‹  ìš´ë™ìœ¼ë¡œ ì²´ë ¥ ìœ ì§€ì— íš¨ê³¼ì ' },
                    { exercise: 'í•„ë¼í…ŒìŠ¤', duration: 30, reason: 'ê·¼ë ¥ê³¼ ìì„¸ ê°œì„ ì— ë„ì›€' }
                ];
            }

            // ì²´ì¤‘ ì°¨ì´ì— ë”°ë¥¸ ê°•ë„ ì¡°ì ˆ
            const intensity = Math.abs(weightDiff);
            if (intensity > 10) {
                recommendations.forEach(rec => {
                    rec.duration = Math.min(rec.duration + 15, 60);
                });
            } else if (intensity > 5) {
                recommendations.forEach(rec => {
                    rec.duration = Math.min(rec.duration + 10, 60);
                });
            }

            return recommendations.slice(0, 3); // ìƒìœ„ 3ê°œ ì¶”ì²œ
        }

        function displayRecommendations(recommendations, profile) {
            const resultDiv = document.getElementById('recommendationResult');
            const weightDiff = profile.targetWeight - profile.weight;
            const goalText = profile.weightGoal === 'lose' ? 'ê°ëŸ‰' : 
                           profile.weightGoal === 'gain' ? 'ì¦ê°€' : 'ìœ ì§€';
            
            const encouragementMessages = {
                'lose': [
                    'í•˜ë£¨í•˜ë£¨ ê¿ˆì— ê°€ê¹Œì›Œì§€ê³  ìˆì–´ìš”! ì˜¤ëŠ˜ë„ í™”ì´íŒ…! ğŸ’ª',
                    'ì¡¸ì€ ì‹œì‘ì´ ë°˜ì´ì—ìš”. ì˜¤ëŠ˜ë¶€í„° ì‹œì‘í•´ë³¼ê¹Œìš”? ğŸ†',
                    'ì¼ì£¼ì¼ì— 3-4íšŒë§Œ í•´ë„ ë¶„ëª… ë³€í™”ë¥¼ ëŠë‚„ ìˆ˜ ìˆì„ ê±°ì˜ˆìš”! ğŸŒŸ',
                    'ìƒìƒë„ ëª»í•  ë‚´ì¼ì˜ ë‚´ ëª¨ìŠµì„ ìœ„í•´ ì˜¤ëŠ˜ ì‹œì‘í•´ìš”! âœ¨'
                ],
                'gain': [
                    'ê±´ê°•í•œ ê·¼ìœ¡ì„ ë§Œë“¤ì–´ê°€ëŠ” ì—¬ì •, ì‘ì›í• ê²Œìš”! ğŸ’ª',
                    'ê·¼ë ¥ìš´ë™ì€ ì™¸ëª¨ë„ ê±´ê°•ë„ ë‘˜ ë‹¤ ì¡ëŠ” ì¼ì„ì´ì¡°! ğŸ†',
                    'ì˜¤ëŠ˜ì˜ ì—´ì‹¬ì´ ë‚´ì¼ì˜ ë” ë‹¨ë‹¨í•œ ë‚˜ë¥¼ ë§Œë“¤ì–´ìš”! ğŸŒŸ',
                    'ê±´ê°•í•œ ëª¸ì„ ë§Œë“œëŠ” ê²ƒì€ ëŒ€ë‹¨í•œ ë„ì „ì´ì—ìš”. ì¶•í•˜í•´ìš”! âœ¨'
                ],
                'maintain': [
                    'ì§€ê¸ˆì˜ ì¢‹ì€ ìƒíƒœë¥¼ ìœ ì§€í•˜ëŠ” ê²ƒë„ ë¯¸ë•ì´ì—ìš”! ğŸ’ª',
                    'ê±´ê°•í•œ ì‚¶ì˜ ë¹„ê²°ì€ ë°”ë¡œ ê¿ˆì„ì—†ëŠ” ìš´ë™ì´ì£ ! ğŸ†',
                    'ì˜¤ëŠ˜ë„ ê±´ê°•í•œ í•˜ë£¨ë¥¼ ì„ íƒí•˜ì‹  ë‹¹ì‹ ì´ ëŒ€ë‹¨í•´ìš”! ğŸŒŸ',
                    'ìš´ë™ì´ ë¶€ë‹´ìŠ¤ëŸ½ì§€ ì•Šì„ ë•Œ ì‹œì‘í•˜ëŠ” ê²ƒì´ ìµœê³ ! âœ¨'
                ]
            };

            const randomMessage = encouragementMessages[profile.weightGoal] ? 
                encouragementMessages[profile.weightGoal][Math.floor(Math.random() * encouragementMessages[profile.weightGoal].length)] :
                'ì˜¤ëŠ˜ë„ ê±´ê°•í•œ í•˜ë£¨ ë³´ë‚´ì„¸ìš”! ğŸ’ª';

            let recommendationHTML = `
                <h4>ğŸ¯ ëª©í‘œ: ${Math.abs(weightDiff).toFixed(1)}kg ${goalText}</h4>
                <p><strong>ì¶”ì²œ ìš´ë™ ë©”ë‰´:</strong></p>
            `;

            recommendations.forEach((rec, index) => {
                const calories = calculatePersonalizedCalories(rec.exercise, rec.duration);
                recommendationHTML += `
                    <div class="exercise-recommendation">
                        <strong>${index + 1}. ${rec.exercise}</strong> - ${rec.duration}ë¶„ (${calories}kcal)
                        <br><small>ğŸ“ ${rec.reason}</small>
                        <br><button class="add-to-plan-btn" onclick="addRecommendationToPlan('${rec.exercise}', ${rec.duration}, ${calories})">ğŸ“ ê³„íšì— ì¶”ê°€</button>
                    </div>
                `;
            });

            recommendationHTML += `
                <p class="encouragement-text">${randomMessage}</p>
            `;

            resultDiv.innerHTML = recommendationHTML;
            resultDiv.style.display = 'block';
        }

        function addRecommendationToPlan(exercise, duration, calories) {
            const plan = {
                name: exercise,
                duration: duration,
                calories: calories,
                timestamp: new Date().toLocaleTimeString()
            };
            
            const plans = savePlan(plan);
            displayPlans(plans);
            updatePlanSummary(plans);
            
            // ì¶”ì²œ ì„¹ì…˜ ìˆ¨ê¸°ê¸°
            checkAndShowRecommendations();
            
            alert(`${exercise} ìš´ë™ì´ ê³„íšì— ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!`);
        }

        function checkAndShowRecommendations() {
            const selectedDate = document.getElementById('recordDate').value;
            const plans = JSON.parse(localStorage.getItem(`plans_${selectedDate}`)) || [];
            const exercises = JSON.parse(localStorage.getItem(`exercises_${selectedDate}`)) || [];
            const profile = JSON.parse(localStorage.getItem('userProfile'));
            
            const recommendationSection = document.getElementById('recommendationSection');
            
            // ê³„íšì´ë‚˜ ê¸°ë¡ì´ ìˆê³ , ëª©í‘œ ì²´ì¤‘ì´ ì„¤ì •ëœ ê²½ìš°ì—ë§Œ ì¶”ì²œ ë³´ì´ê¸°
            if (plans.length === 0 && exercises.length === 0 && profile && profile.targetWeight) {
                recommendationSection.style.display = 'block';
            } else {
                recommendationSection.style.display = 'none';
            }
        }

        // ê¸°ì¡´ loadData í•¨ìˆ˜ ìˆ˜ì •
        const originalLoadData = loadData;
        loadData = function() {
            originalLoadData();
            loadPlans();
            checkAndShowRecommendations();
        };

        // ì˜ì–‘ì„±ë¶„í‘œ ì´ë¯¸ì§€ ë¶„ì„ ê¸°ëŠ¥
        let selectedNutritionImage = null;

        function selectNutritionImage() {
            document.getElementById('nutritionImage').click();
        }

        document.getElementById('nutritionImage').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                selectedNutritionImage = file;
                
                // ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸°
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('previewImg').src = e.target.result;
                    document.getElementById('imagePreview').style.display = 'block';
                    document.getElementById('analyzeBtn').disabled = false;
                    document.querySelector('.nutrition-scanner').classList.add('active');
                };
                reader.readAsDataURL(file);
            }
        });

        function analyzeNutritionImage() {
            if (!selectedNutritionImage) {
                alert('ë¨¼ì € ì´ë¯¸ì§€ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }

            const analyzeBtn = document.getElementById('analyzeBtn');
            const resultDiv = document.getElementById('analysisResult');
            const contentDiv = document.getElementById('analysisContent');
            
            // ë¡œë”© ìƒíƒœ í‘œì‹œ
            analyzeBtn.disabled = true;
            analyzeBtn.innerHTML = '<div class="loading-spinner"></div>ë¶„ì„ ì¤‘...';
            
            resultDiv.style.display = 'block';
            resultDiv.className = 'analysis-result';
            contentDiv.innerHTML = '<p>ì˜ì–‘ì„±ë¶„í‘œë¥¼ ë¶„ì„í•˜ê³  ìˆìŠµë‹ˆë‹¤. ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”...</p>';

            // Tesseract.jsë¡œ OCR ìˆ˜í–‰
            Tesseract.recognize(selectedNutritionImage, 'kor+eng', {
                logger: m => {
                    if (m.status === 'recognizing text') {
                        const progress = Math.round(m.progress * 100);
                        contentDiv.innerHTML = `<p>í…ìŠ¤íŠ¸ ì¸ì‹ ì¤‘... ${progress}%</p>`;
                    }
                }
            }).then(({ data: { text } }) => {
                console.log('ì¸ì‹ëœ í…ìŠ¤íŠ¸:', text);
                
                // ì˜ì–‘ì„±ë¶„ ì •ë³´ ì¶”ì¶œ
                const nutritionData = parseNutritionText(text);
                
                if (nutritionData) {
                    displayNutritionResults(nutritionData);
                } else {
                    showAnalysisError('ì˜ì–‘ì„±ë¶„ ì •ë³´ë¥¼ ì¸ì‹í•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. ì´ë¯¸ì§€ê°€ ëª…í™•í•œì§€ í™•ì¸í•´ì£¼ì„¸ìš”.');
                }
            }).catch(error => {
                console.error('OCR ì—ëŸ¬:', error);
                showAnalysisError('ì´ë¯¸ì§€ ë¶„ì„ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }).finally(() => {
                // ë¡œë”© ìƒíƒœ í•´ì œ
                analyzeBtn.disabled = false;
                analyzeBtn.innerHTML = 'ğŸ” ë¶„ì„ ì‹œì‘';
            });
        }

        function parseNutritionText(text) {
            const lines = text.split('\n').map(line => line.trim()).filter(line => line.length > 0);
            const nutritionData = {
                calories: null,
                carbs: null,
                protein: null,
                fat: null,
                name: null
            };

            // ì œí’ˆëª… ì¶”ì¶œ (ì²˜ìŒ ë³„ì˜ ìˆ«ìê°€ ì—†ëŠ” ê¸´ ì¤„)
            for (let i = 0; i < Math.min(lines.length, 5); i++) {
                const line = lines[i];
                if (line.length > 3 && !/\d/.test(line) && !/ì¹¼ë¡œë¦¬|ì—´ëŸ‰|íƒ„ìˆ˜í™”ë¬¼|ë‹¨ë°±ì§ˆ|ì§€ë°©|carbohydrate|protein|fat|calorie/i.test(line)) {
                    nutritionData.name = line;
                    break;
                }
            }

            // ì˜ì–‘ì„±ë¶„ ì •ë³´ ì¶”ì¶œ
            for (const line of lines) {
                const lowerLine = line.toLowerCase();
                
                // ì¹¼ë¡œë¦¬ ì¶”ì¶œ
                if ((/ì¹¼ë¡œë¦¬|ì—´ëŸ‰|calorie|kcal/i.test(line)) && !nutritionData.calories) {
                    const calorieMatch = line.match(/([0-9,]+(?:\.[0-9]+)?)[\s]*(?:kcal|cal|ì¹¼ë¡œë¦¬)/i);
                    if (calorieMatch) {
                        nutritionData.calories = parseFloat(calorieMatch[1].replace(/,/g, ''));
                    }
                }
                
                // íƒ„ìˆ˜í™”ë¬¼ ì¶”ì¶œ
                if ((/íƒ„ìˆ˜í™”ë¬¼|carbohydrate|carbs/i.test(line)) && !nutritionData.carbs) {
                    const carbMatch = line.match(/([0-9,]+(?:\.[0-9]+)?)[\s]*(?:g|ê·¸ë¨)/i);
                    if (carbMatch) {
                        nutritionData.carbs = parseFloat(carbMatch[1].replace(/,/g, ''));
                    }
                }
                
                // ë‹¨ë°±ì§ˆ ì¶”ì¶œ
                if ((/ë‹¨ë°±ì§ˆ|protein/i.test(line)) && !nutritionData.protein) {
                    const proteinMatch = line.match(/([0-9,]+(?:\.[0-9]+)?)[\s]*(?:g|ê·¸ë¨)/i);
                    if (proteinMatch) {
                        nutritionData.protein = parseFloat(proteinMatch[1].replace(/,/g, ''));
                    }
                }
                
                // ì§€ë°© ì¶”ì¶œ
                if ((/ì§€ë°©|fat/i.test(line)) && !nutritionData.fat) {
                    const fatMatch = line.match(/([0-9,]+(?:\.[0-9]+)?)[\s]*(?:g|ê·¸ë¨)/i);
                    if (fatMatch) {
                        nutritionData.fat = parseFloat(fatMatch[1].replace(/,/g, ''));
                    }
                }
            }

            // ìµœì†Œ í•˜ë‚˜ì˜ ì˜ì–‘ì„±ë¶„ì´ ì¸ì‹ë˜ì—ˆëŠ”ì§€ í™•ì¸
            if (nutritionData.calories || nutritionData.carbs || nutritionData.protein || nutritionData.fat) {
                return nutritionData;
            }
            
            return null;
        }

        function displayNutritionResults(nutritionData) {
            const resultDiv = document.getElementById('analysisResult');
            const contentDiv = document.getElementById('analysisContent');
            
            resultDiv.className = 'analysis-result success';
            
            let html = '<div class="nutrition-info">';
            html += '<h5>ğŸ‰ ì˜ì–‘ì„±ë¶„ ì¸ì‹ ì„±ê³µ!</h5>';
            
            if (nutritionData.name) {
                html += `<p><strong>ì œí’ˆëª…:</strong> ${nutritionData.name}</p>`;
            }
            
            html += '<div class="nutrition-values">';
            
            if (nutritionData.calories) {
                html += `<div class="nutrition-value"><strong>ì¹¼ë¡œë¦¬</strong><br>${nutritionData.calories} kcal</div>`;
            }
            if (nutritionData.carbs) {
                html += `<div class="nutrition-value"><strong>íƒ„ìˆ˜í™”ë¬¼</strong><br>${nutritionData.carbs} g</div>`;
            }
            if (nutritionData.protein) {
                html += `<div class="nutrition-value"><strong>ë‹¨ë°±ì§ˆ</strong><br>${nutritionData.protein} g</div>`;
            }
            if (nutritionData.fat) {
                html += `<div class="nutrition-value"><strong>ì§€ë°©</strong><br>${nutritionData.fat} g</div>`;
            }
            
            html += '</div>';
            html += '<button class="apply-nutrition-btn" onclick="applyNutritionData(' + JSON.stringify(nutritionData).replace(/"/g, '&quot;') + ')">âœ… ì‹ë‹¨ í¼ì— ì ìš©</button>';
            html += '</div>';
            
            contentDiv.innerHTML = html;
        }

        function showAnalysisError(message) {
            const resultDiv = document.getElementById('analysisResult');
            const contentDiv = document.getElementById('analysisContent');
            
            resultDiv.className = 'analysis-result error';
            contentDiv.innerHTML = `<p>âš ï¸ ${message}</p><p><small>íŒ: ì˜ì–‘ì„±ë¶„í‘œê°€ ëª…í™•í•˜ê³  í•œê¸€ì´ë‚˜ ì˜ì–´ë¡œ ì‘ì„±ëœ ì´ë¯¸ì§€ë¥¼ ì‚¬ìš©í•´ì£¼ì„¸ìš”.</small></p>`;
        }

        function applyNutritionData(nutritionData) {
            if (nutritionData.name) {
                document.getElementById('foodName').value = nutritionData.name;
            }
            if (nutritionData.calories) {
                document.getElementById('foodCalories').value = nutritionData.calories;
            }
            if (nutritionData.carbs) {
                document.getElementById('foodCarbs').value = nutritionData.carbs;
            }
            if (nutritionData.protein) {
                document.getElementById('foodProtein').value = nutritionData.protein;
            }
            if (nutritionData.fat) {
                document.getElementById('foodFat').value = nutritionData.fat;
            }
            
            // ì„±ê³µ ë©”ì‹œì§€
            alert('ì˜ì–‘ì„±ë¶„ ì •ë³´ê°€ ì‹ë‹¨ í¼ì— ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤! ì–‘ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
            
            // ì–‘ ì…ë ¥ í•„ë“œì— í¬ì»¤ìŠ¤
            document.getElementById('foodAmount').focus();
        }

        // ê¸°ë¡ ìˆ˜ì • ê¸°ëŠ¥
        let editingExerciseIndex = -1;
        let editingFoodIndex = -1;

        // ìš´ë™ ê¸°ë¡ ìˆ˜ì •
        function editExercise(index) {
            const selectedDate = document.getElementById('recordDate').value;
            const exercises = JSON.parse(localStorage.getItem(`exercises_${selectedDate}`)) || [];
            const exercise = exercises[index];
            
            if (!exercise) {
                alert('ìˆ˜ì •í•  ìš´ë™ ê¸°ë¡ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            editingExerciseIndex = index;
            
            // ëª¨ë‹¬ì— ê¸°ì¡´ ë°ì´í„° ì±„ìš°ê¸°
            document.getElementById('editExerciseName').value = exercise.name;
            document.getElementById('editExerciseDuration').value = exercise.duration;
            document.getElementById('editExerciseCalories').value = exercise.calories;
            
            // ëª¨ë‹¬ ì—´ê¸°
            document.getElementById('editExerciseModal').style.display = 'block';
        }

        function closeEditExerciseModal() {
            document.getElementById('editExerciseModal').style.display = 'none';
            editingExerciseIndex = -1;
        }

        // ìš´ë™ ê¸°ë¡ ìˆ˜ì • ì‹œ ì¹¼ë¡œë¦¬ ì¬ê³„ì‚°
        document.getElementById('editExerciseDuration').addEventListener('input', function() {
            const exerciseName = document.getElementById('editExerciseName').value;
            const duration = parseInt(this.value) || 0;
            
            if (exerciseName && duration > 0) {
                const calories = calculatePersonalizedCalories(exerciseName, duration);
                document.getElementById('editExerciseCalories').value = calories;
            }
        });

        document.getElementById('editExerciseName').addEventListener('input', function() {
            const exerciseName = this.value;
            const duration = parseInt(document.getElementById('editExerciseDuration').value) || 0;
            
            if (exerciseName && duration > 0) {
                const calories = calculatePersonalizedCalories(exerciseName, duration);
                document.getElementById('editExerciseCalories').value = calories;
            }
        });

        // ìš´ë™ ê¸°ë¡ ìˆ˜ì • ì €ì¥
        document.getElementById('editExerciseForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            if (editingExerciseIndex === -1) {
                alert('ìˆ˜ì • ì¤‘ì¸ ê¸°ë¡ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            const selectedDate = document.getElementById('recordDate').value;
            const exercises = JSON.parse(localStorage.getItem(`exercises_${selectedDate}`)) || [];
            
            // ìˆ˜ì •ëœ ë°ì´í„°
            const updatedExercise = {
                name: document.getElementById('editExerciseName').value,
                duration: parseInt(document.getElementById('editExerciseDuration').value),
                calories: parseInt(document.getElementById('editExerciseCalories').value),
                timestamp: exercises[editingExerciseIndex].timestamp // ê¸°ì¡´ ì‹œê°„ ìœ ì§€
            };
            
            // ê¸°ë¡ ì—…ë°ì´íŠ¸
            exercises[editingExerciseIndex] = updatedExercise;
            localStorage.setItem(`exercises_${selectedDate}`, JSON.stringify(exercises));
            
            // í™”ë©´ ìƒˆë¡œê³ ì¹¨
            displayExercises(exercises);
            updateSummary(exercises, JSON.parse(localStorage.getItem(`foods_${selectedDate}`)) || []);
            
            // ë¹„êµ íƒ­ì´ í™œì„±í™”ë˜ì–´ ìˆë‹¤ë©´ ì—…ë°ì´íŠ¸
            if (document.getElementById('compareTab').classList.contains('active')) {
                updateComparison();
            }
            
            closeEditExerciseModal();
            alert('ìš´ë™ ê¸°ë¡ì´ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.');
        });

        // ì‹ë‹¨ ê¸°ë¡ ìˆ˜ì •
        function editFood(index) {
            const selectedDate = document.getElementById('recordDate').value;
            const foods = JSON.parse(localStorage.getItem(`foods_${selectedDate}`)) || [];
            const food = foods[index];
            
            if (!food) {
                alert('ìˆ˜ì •í•  ì‹ë‹¨ ê¸°ë¡ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            editingFoodIndex = index;
            
            // ëª¨ë‹¬ì— ê¸°ì¡´ ë°ì´í„° ì±„ìš°ê¸°
            document.getElementById('editFoodName').value = food.name;
            document.getElementById('editFoodAmount').value = food.amount;
            document.getElementById('editFoodCalories').value = food.calories;
            document.getElementById('editFoodCarbs').value = food.carbs || 0;
            document.getElementById('editFoodProtein').value = food.protein || 0;
            document.getElementById('editFoodFat').value = food.fat || 0;
            document.getElementById('editMealTime').value = food.mealTime;
            
            // ëª¨ë‹¬ ì—´ê¸°
            document.getElementById('editFoodModal').style.display = 'block';
        }

        function closeEditFoodModal() {
            document.getElementById('editFoodModal').style.display = 'none';
            editingFoodIndex = -1;
        }

        // ì‹ë‹¨ ê¸°ë¡ ìˆ˜ì • ì €ì¥
        document.getElementById('editFoodForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            if (editingFoodIndex === -1) {
                alert('ìˆ˜ì • ì¤‘ì¸ ê¸°ë¡ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            const selectedDate = document.getElementById('recordDate').value;
            const foods = JSON.parse(localStorage.getItem(`foods_${selectedDate}`)) || [];
            
            // ìˆ˜ì •ëœ ë°ì´í„°
            const updatedFood = {
                name: document.getElementById('editFoodName').value,
                amount: parseInt(document.getElementById('editFoodAmount').value),
                calories: parseInt(document.getElementById('editFoodCalories').value),
                carbs: parseFloat(document.getElementById('editFoodCarbs').value) || 0,
                protein: parseFloat(document.getElementById('editFoodProtein').value) || 0,
                fat: parseFloat(document.getElementById('editFoodFat').value) || 0,
                mealTime: document.getElementById('editMealTime').value,
                timestamp: foods[editingFoodIndex].timestamp // ê¸°ì¡´ ì‹œê°„ ìœ ì§€
            };
            
            // ê¸°ë¡ ì—…ë°ì´íŠ¸
            foods[editingFoodIndex] = updatedFood;
            localStorage.setItem(`foods_${selectedDate}`, JSON.stringify(foods));
            
            // í™”ë©´ ìƒˆë¡œê³ ì¹¨
            displayFoods(foods);
            updateSummary(JSON.parse(localStorage.getItem(`exercises_${selectedDate}`)) || [], foods);
            
            closeEditFoodModal();
            alert('ì‹ë‹¨ ê¸°ë¡ì´ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.');
        });

        // ìš´ë™ ê³„íš ìˆ˜ì • ê¸°ëŠ¥
        let editingPlanIndex = -1;

        function editPlan(index) {
            const selectedDate = document.getElementById('recordDate').value;
            const plans = JSON.parse(localStorage.getItem(`plans_${selectedDate}`)) || [];
            const plan = plans[index];
            
            if (!plan) {
                alert('ìˆ˜ì •í•  ìš´ë™ ê³„íšì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            editingPlanIndex = index;
            
            // ëª¨ë‹¬ì— ê¸°ì¡´ ë°ì´í„° ì±„ìš°ê¸°
            document.getElementById('editPlanExerciseName').value = plan.name;
            document.getElementById('editPlanExerciseDuration').value = plan.duration;
            document.getElementById('editPlanExerciseCalories').value = plan.calories;
            
            // ëª¨ë‹¬ ì—´ê¸°
            document.getElementById('editPlanModal').style.display = 'block';
        }

        function closeEditPlanModal() {
            document.getElementById('editPlanModal').style.display = 'none';
            editingPlanIndex = -1;
        }

        // ìš´ë™ ê³„íš ìˆ˜ì • ì‹œ ì¹¼ë¡œë¦¬ ì¬ê³„ì‚°
        document.getElementById('editPlanExerciseDuration').addEventListener('input', function() {
            const exerciseName = document.getElementById('editPlanExerciseName').value;
            const duration = parseInt(this.value) || 0;
            
            if (exerciseName && duration > 0) {
                const calories = calculatePersonalizedCalories(exerciseName, duration);
                document.getElementById('editPlanExerciseCalories').value = calories;
            }
        });

        document.getElementById('editPlanExerciseName').addEventListener('input', function() {
            const exerciseName = this.value;
            const duration = parseInt(document.getElementById('editPlanExerciseDuration').value) || 0;
            
            if (exerciseName && duration > 0) {
                const calories = calculatePersonalizedCalories(exerciseName, duration);
                document.getElementById('editPlanExerciseCalories').value = calories;
            }
        });

        // ìš´ë™ ê³„íš ìˆ˜ì • ì €ì¥
        document.getElementById('editPlanForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            if (editingPlanIndex === -1) {
                alert('ìˆ˜ì • ì¤‘ì¸ ê³„íšì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            const selectedDate = document.getElementById('recordDate').value;
            const plans = JSON.parse(localStorage.getItem(`plans_${selectedDate}`)) || [];
            
            // ìˆ˜ì •ëœ ë°ì´í„°
            const updatedPlan = {
                name: document.getElementById('editPlanExerciseName').value,
                duration: parseInt(document.getElementById('editPlanExerciseDuration').value),
                calories: parseInt(document.getElementById('editPlanExerciseCalories').value),
                timestamp: plans[editingPlanIndex].timestamp // ê¸°ì¡´ ì‹œê°„ ìœ ì§€
            };
            
            // ê³„íš ì—…ë°ì´íŠ¸
            plans[editingPlanIndex] = updatedPlan;
            localStorage.setItem(`plans_${selectedDate}`, JSON.stringify(plans));
            
            // í™”ë©´ ìƒˆë¡œê³ ì¹¨
            displayPlans(plans);
            updatePlanSummary(plans);
            
            // ë¹„êµ íƒ­ì´ í™œì„±í™”ë˜ì–´ ìˆë‹¤ë©´ ì—…ë°ì´íŠ¸
            if (document.getElementById('compareTab').classList.contains('active')) {
                updateComparison();
            }
            
            // ì¶”ì²œ ìš´ë™ ì¬ê²€í† 
            checkAndShowRecommendations();
            
            closeEditPlanModal();
            alert('ìš´ë™ ê³„íšì´ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.');
        });

        // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
        window.addEventListener('click', function(event) {
            const exerciseModal = document.getElementById('editExerciseModal');
            const foodModal = document.getElementById('editFoodModal');
            const planModal = document.getElementById('editPlanModal');
            const profileModal = document.getElementById('profileModal');
            
            if (event.target === exerciseModal) {
                closeEditExerciseModal();
            } else if (event.target === foodModal) {
                closeEditFoodModal();
            } else if (event.target === planModal) {
                closeEditPlanModal();
            } else if (event.target === profileModal) {
                closeProfileModal();
            }
        });

        // ì›¹ ê²€ìƒ‰ ê¸°ëŠ¥
        function searchFoodNutrition() {
            const query = document.getElementById('webSearchInput').value.trim();
            if (!query) {
                alert('ê²€ìƒ‰í•  ìŒì‹ ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            const searchBtn = document.getElementById('webSearchBtn');
            const resultsDiv = document.getElementById('webSearchResults');
            const searchSection = document.querySelector('.web-search-section');

            // ë¡œë”© ìƒíƒœ
            searchBtn.disabled = true;
            searchBtn.innerHTML = '<div class="loading-spinner"></div>ê²€ìƒ‰ ì¤‘...';
            searchSection.classList.add('searching');
            resultsDiv.style.display = 'block';
            resultsDiv.className = 'web-search-results show';
            resultsDiv.innerHTML = '<p>ìŒì‹ ì˜ì–‘ ì •ë³´ë¥¼ ê²€ìƒ‰í•˜ê³  ìˆìŠµë‹ˆë‹¤...</p>';

            // ì´ì „ ê²€ìƒ‰ ê¸°ë¡ í™•ì¸
            const searchHistory = JSON.parse(localStorage.getItem('foodSearchHistory')) || {};
            if (searchHistory[query]) {
                displaySearchResult(searchHistory[query], query);
                resetSearchButton();
                return;
            }

            // ì‹œë®¬ë ˆì´ì…˜ëœ ê²€ìƒ‰ ê²°ê³¼ (ì‹¤ì œ êµ¬í˜„ì—ì„œëŠ” ì‹¤ì œ APIë¥¼ ì‚¬ìš©)
            setTimeout(() => {
                const nutritionData = simulateWebSearch(query);
                
                if (nutritionData) {
                    // ê²€ìƒ‰ ê¸°ë¡ ì €ì¥
                    searchHistory[query] = nutritionData;
                    localStorage.setItem('foodSearchHistory', JSON.stringify(searchHistory));
                    
                    displaySearchResult(nutritionData, query);
                } else {
                    showSearchError(query);
                }
                
                resetSearchButton();
            }, 1500);
        }

        function simulateWebSearch(query) {
            // ì‹¤ì œ êµ¬í˜„ì—ì„œëŠ” êµ¬ê¸€ ê²€ìƒ‰ APIë‚˜ ì˜ì–‘ ë°ì´í„°ë² ì´ìŠ¤ APIë¥¼ ì‚¬ìš©
            const mockData = {
                'ì‚¼ê°ê¹€ë°¥': { calories: 180, carbs: 35, protein: 4, fat: 2 },
                'ì‚¼ê°ê¹€ë°¥ ì¹¼ë¡œë¦¬': { calories: 180, carbs: 35, protein: 4, fat: 2 },
                'ì¹˜ì¦ˆë²„ê±°': { calories: 540, carbs: 40, protein: 25, fat: 31 },
                'ì¹˜ì¦ˆë²„ê±° ì¹¼ë¡œë¦¬': { calories: 540, carbs: 40, protein: 25, fat: 31 },
                'ì•„ë©”ë¦¬ì¹´ë…¸': { calories: 15, carbs: 3, protein: 1, fat: 0.5 },
                'ì•„ë©”ë¦¬ì¹´ë…¸ ì¹¼ë¡œë¦¬': { calories: 15, carbs: 3, protein: 1, fat: 0.5 },
                'ì—ìŠ¤í”„ë ˆì†Œ': { calories: 5, carbs: 1, protein: 0.5, fat: 0.2 },
                'ì—ìŠ¤í”„ë ˆì†Œ ì¹¼ë¡œë¦¬': { calories: 5, carbs: 1, protein: 0.5, fat: 0.2 },
                'ì•„ë³´ì¹´ë„': { calories: 160, carbs: 9, protein: 2, fat: 15 },
                'ì•„ë³´ì¹´ë„ ì¹¼ë¡œë¦¬': { calories: 160, carbs: 9, protein: 2, fat: 15 },
                'ì—°ì–´ì´ˆë°¥': { calories: 200, carbs: 30, protein: 25, fat: 1 },
                'ì—°ì–´ì´ˆë°¥ ì¹¼ë¡œë¦¬': { calories: 200, carbs: 30, protein: 25, fat: 1 },
                'ìƒëŸ¬ë“œ': { calories: 20, carbs: 4, protein: 1, fat: 0.2 },
                'ê·¸ë¦°ìƒëŸ¬ë“œ': { calories: 20, carbs: 4, protein: 1, fat: 0.2 },
                'ì‹œì €ìƒëŸ¬ë“œ': { calories: 150, carbs: 10, protein: 3, fat: 12 },
                'í† ë§ˆí† ': { calories: 18, carbs: 4, protein: 1, fat: 0.2 },
                'í† ë§ˆí†  ì¹¼ë¡œë¦¬': { calories: 18, carbs: 4, protein: 1, fat: 0.2 },
                'íŒŒìŠ¤íƒ€': { calories: 220, carbs: 43, protein: 8, fat: 2 },
                'íŒŒìŠ¤íƒ€ ì¹¼ë¡œë¦¬': { calories: 220, carbs: 43, protein: 8, fat: 2 }
            };

            // ë¶€ë¶„ ë§¤ì¹­ ê²€ìƒ‰
            const lowerQuery = query.toLowerCase();
            for (const [key, value] of Object.entries(mockData)) {
                if (key.toLowerCase().includes(lowerQuery) || lowerQuery.includes(key.toLowerCase())) {
                    return { ...value, name: key };
                }
            }

            // ì¼ë°˜ì ì¸ ê²€ìƒ‰ì–´ì— ë”°ë¥¸ ì¶”ì •ì¹˜
            if (lowerQuery.includes('ë²„ê±°') || lowerQuery.includes('í–„ë²„ê±°')) {
                return { calories: 500, carbs: 40, protein: 20, fat: 25, name: query };
            }
            if (lowerQuery.includes('í”¼ì')) {
                return { calories: 285, carbs: 36, protein: 12, fat: 10, name: query };
            }
            if (lowerQuery.includes('ë°¥') || lowerQuery.includes('ë¼ì´ìŠ¤')) {
                return { calories: 130, carbs: 28, protein: 2.7, fat: 0.3, name: query };
            }
            if (lowerQuery.includes('ìƒëŸ¬ë“œ')) {
                return { calories: 25, carbs: 5, protein: 2, fat: 0.3, name: query };
            }
            if (lowerQuery.includes('ì»¤í”¼')) {
                return { calories: 5, carbs: 1, protein: 0.3, fat: 0, name: query };
            }
            if (lowerQuery.includes('ì£¼ìŠ¤')) {
                return { calories: 45, carbs: 11, protein: 0.5, fat: 0.2, name: query };
            }

            return null;
        }

        function displaySearchResult(nutritionData, query) {
            const resultsDiv = document.getElementById('webSearchResults');
            resultsDiv.className = 'web-search-results show success';
            
            let html = '<div class="nutrition-found">';
            html += '<h5>ğŸ‰ ì˜ì–‘ ì •ë³´ë¥¼ ì°¾ì•˜ìŠµë‹ˆë‹¤!</h5>';
            html += `<p><strong>ìŒì‹:</strong> ${nutritionData.name || query}</p>`;
            
            html += '<div class="nutrition-grid">';
            html += `<div class="nutrition-item"><strong>ì¹¼ë¡œë¦¬</strong>${nutritionData.calories || 0} kcal</div>`;
            html += `<div class="nutrition-item"><strong>íƒ„ìˆ˜í™”ë¬¼</strong>${nutritionData.carbs || 0} g</div>`;
            html += `<div class="nutrition-item"><strong>ë‹¨ë°±ì§ˆ</strong>${nutritionData.protein || 0} g</div>`;
            html += `<div class="nutrition-item"><strong>ì§€ë°©</strong>${nutritionData.fat || 0} g</div>`;
            html += '</div>';
            
            html += '<button class="apply-web-search-btn" onclick="applyWebSearchData(' + JSON.stringify(nutritionData).replace(/"/g, '&quot;') + ', \'' + query + '\')">âœ… ì‹ë‹¨ í¼ì— ì ìš©</button>';
            
            html += '<div class="search-sources">ê²€ìƒ‰ ê²°ê³¼ëŠ” ì¼ë°˜ì ì¸ ì˜ì–‘ ì •ë³´ë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•©ë‹ˆë‹¤.</div>';
            html += '<div class="search-disclaimer">âš ï¸ ì˜ì–‘ ì •ë³´ëŠ” ì œí’ˆì— ë”°ë¼ ë‹¤ë¥¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì •í™•í•œ ì •ë³´ëŠ” ì œí’ˆ ë¼ë²¨ì„ í™•ì¸í•´ì£¼ì„¸ìš”.</div>';
            html += '</div>';
            
            resultsDiv.innerHTML = html;
        }

        function showSearchError(query) {
            const resultsDiv = document.getElementById('webSearchResults');
            resultsDiv.className = 'web-search-results show error';
            resultsDiv.innerHTML = `
                <p>âš ï¸ "${query}"ì— ëŒ€í•œ ì˜ì–‘ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>
                <p><small>íŒ: ë” êµ¬ì²´ì ì¸ ìŒì‹ ì´ë¦„ì„ ì…ë ¥í•´ë³´ì„¸ìš”. (ì˜ˆ: "ì‚¼ê°ê¹€ë°¥ ì¹¼ë¡œë¦¬")</small></p>
                <p><small>ì˜ì–‘ì„±ë¶„í‘œ ìŠ¤ìº” ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ê±°ë‚˜ ì§ì ‘ ì…ë ¥í•´ì£¼ì„¸ìš”.</small></p>
            `;
        }

        function resetSearchButton() {
            const searchBtn = document.getElementById('webSearchBtn');
            const searchSection = document.querySelector('.web-search-section');
            
            searchBtn.disabled = false;
            searchBtn.innerHTML = 'ğŸ” ê²€ìƒ‰';
            searchSection.classList.remove('searching');
        }

        function applyWebSearchData(nutritionData, query) {
            document.getElementById('foodName').value = nutritionData.name || query;
            document.getElementById('foodCalories').value = nutritionData.calories || 0;
            document.getElementById('foodCarbs').value = nutritionData.carbs || 0;
            document.getElementById('foodProtein').value = nutritionData.protein || 0;
            document.getElementById('foodFat').value = nutritionData.fat || 0;
            
            // ê¸°ë³¸ ì–‘ 100gìœ¼ë¡œ ì„¤ì •
            document.getElementById('foodAmount').value = 100;
            
            alert('ì˜ì–‘ ì •ë³´ê°€ ì‹ë‹¨ í¼ì— ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤! ì–‘ì„ ì¡°ì •í•´ì£¼ì„¸ìš”.');
            
            // ì–‘ ì…ë ¥ í•„ë“œì— í¬ì»¤ìŠ¤
            document.getElementById('foodAmount').focus();
        }

        // ì›¹ ê²€ìƒ‰ ì…ë ¥ì—ì„œ ì—”í„° í‚¤ ì§€ì›
        document.getElementById('webSearchInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                searchFoodNutrition();
            }
        });

        // í† ìŠ¤íŠ¸ ë©”ì‹œì§€ ì‹œìŠ¤í…œ
        function showToast(message, type = 'warning', duration = 3000) {
            // ê¸°ì¡´ í† ìŠ¤íŠ¸ ì œê±°
            const existingToast = document.querySelector('.toast');
            if (existingToast) {
                existingToast.remove();
            }

            // ìƒˆ í† ìŠ¤íŠ¸ ìƒì„±
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.innerHTML = `
                ${message}
                <button class="toast-close" onclick="this.parentElement.remove()">&times;</button>
            `;
            
            document.body.appendChild(toast);
            
            // ì• ë‹ˆë©”ì´ì…˜ìœ¼ë¡œ í‘œì‹œ
            setTimeout(() => {
                toast.classList.add('show');
            }, 100);
            
            // ìë™ ì‚¬ë¼ì§
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => {
                    if (toast.parentElement) {
                        toast.remove();
                    }
                }, 300);
            }, duration);
        }

        // ìˆ«ì ì…ë ¥ ê²€ì¦ ê¸°ëŠ¥
        function validateNumberInput(input, fieldName) {
            const value = input.value.trim();
            
            // ë¹ˆ ê°’ì€ í—ˆìš©
            if (value === '') {
                return true;
            }
            
            // ìˆ«ì ê²€ì¦
            const numberPattern = /^\d*\.?\d*$/;
            if (!numberPattern.test(value) || isNaN(parseFloat(value))) {
                // ì—ëŸ¬ ì• ë‹ˆë©”ì´ì…˜
                input.parentElement.classList.add('error');
                setTimeout(() => {
                    input.parentElement.classList.remove('error');
                }, 300);
                
                // í† ìŠ¤íŠ¸ ë©”ì‹œì§€
                showToast(`${fieldName}ì—ëŠ” ìˆ«ìë§Œ ì…ë ¥í•´ì£¼ì„¸ìš”.`, 'warning');
                
                // ì˜ëª»ëœ ê°’ ì‚­ì œ
                input.value = '';
                input.focus();
                
                return false;
            }
            
            return true;
        }

        // ì˜ì–‘ì†Œ í•„ë“œ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
        function addNutritionValidation() {
            const nutritionFields = [
                { id: 'foodCalories', name: 'ì¹¼ë¡œë¦¬' },
                { id: 'foodCarbs', name: 'íƒ„ìˆ˜í™”ë¬¼' },
                { id: 'foodProtein', name: 'ë‹¨ë°±ì§ˆ' },
                { id: 'foodFat', name: 'ì§€ë°©' },
                { id: 'editFoodCalories', name: 'ì¹¼ë¡œë¦¬' },
                { id: 'editFoodCarbs', name: 'íƒ„ìˆ˜í™”ë¬¼' },
                { id: 'editFoodProtein', name: 'ë‹¨ë°±ì§ˆ' },
                { id: 'editFoodFat', name: 'ì§€ë°©' }
            ];

            nutritionFields.forEach(field => {
                const element = document.getElementById(field.id);
                if (element) {
                    // ì…ë ¥ ì‹œ ê²€ì¦
                    element.addEventListener('input', function() {
                        validateNumberInput(this, field.name);
                    });
                    
                    // ë¶™ì—¬ë„£ê¸° ì‹œ ê²€ì¦
                    element.addEventListener('paste', function(e) {
                        setTimeout(() => {
                            validateNumberInput(this, field.name);
                        }, 10);
                    });
                }
            });
        }

        // ê¸°ì¡´ ìŒì‹ ì¹¼ë¡œë¦¬ ê³„ì‚° í•¨ìˆ˜ ìˆ˜ì • (ìˆ˜ë™ ì…ë ¥ ì§€ì›)
        const originalCalculateFoodCalories = calculateFoodCalories;
        calculateFoodCalories = function() {
            const foodName = document.getElementById('foodName').value;
            const amount = parseInt(document.getElementById('foodAmount').value) || 0;
            
            // ìˆ˜ë™ ì…ë ¥ëœ ê°’ì´ ìˆëŠ”ì§€ í™•ì¸
            const manualCalories = document.getElementById('foodCalories').value;
            const manualCarbs = document.getElementById('foodCarbs').value;
            const manualProtein = document.getElementById('foodProtein').value;
            const manualFat = document.getElementById('foodFat').value;
            
            // ìˆ˜ë™ ì…ë ¥ì´ ìˆìœ¼ë©´ ìë™ ê³„ì‚° ìŠ¤í‚µ
            if (manualCalories || manualCarbs || manualProtein || manualFat) {
                return;
            }
            
            // ë°ì´í„°ë² ì´ìŠ¤ì— ìˆëŠ” ìŒì‹ì´ë©´ ìë™ ê³„ì‚°
            if (foodName in foodDatabase && amount > 0) {
                const food = foodDatabase[foodName];
                const ratio = amount / 100;
                
                const calories = Math.round(food.calories * ratio);
                const carbs = Math.round(food.carbs * ratio * 10) / 10;
                const protein = Math.round(food.protein * ratio * 10) / 10;
                const fat = Math.round(food.fat * ratio * 10) / 10;
                
                document.getElementById('foodCalories').value = calories;
                document.getElementById('foodCarbs').value = carbs;
                document.getElementById('foodProtein').value = protein;
                document.getElementById('foodFat').value = fat;
            }
        };

        // ê²©ë ¤ ë©”ì‹œì§€ ì‹œìŠ¤í…œ
        const encouragementMessages = [
            "ì˜¤ëŠ˜ë„ í˜ì°¨ê²Œ ìš´ë™í–ˆë„¤ìš”. ì˜í•˜ì…¨ìŠµë‹ˆë‹¤!",
            "ê³„íšëŒ€ë¡œ ìš´ë™ì„ ì™„ì£¼í•˜ì…¨ë„¤ìš”! ì •ë§ ëŒ€ë‹¨í•´ìš”.",
            "ë©‹ì§„ ì„±ì·¨ì…ë‹ˆë‹¤! ê³„ì† ì´ë ‡ê²Œ ê½ƒê½ƒíˆ í•´ë‚˜ê°€ì„¸ìš”.",
            "ì˜¤ëŠ˜ì˜ ëª©í‘œë¥¼ ë‹¬ì„±í•˜ì…¨ìŠµë‹ˆë‹¤! ìì‹ ì„ ìë‘ìŠ¤ëŸ¬ì›Œí•˜ì„¸ìš”.",
            "í•œ ë‹¨ê³„ ë” ê°€ê¹Œì›Œì§„ ê±´ê°•í•œ ëª¸! ì˜¤ëŠ˜ë„ ê³ ìƒí•˜ì…¨ì–´ìš”.",
            "ê³„íšì„ ì§€í‚¤ëŠ” ëª¨ìŠµì´ ì •ë§ ë©‹ìˆì–´ìš”! ì´ë ‡ê²Œ ê³„ì†í•´ìš”.",
            "ì˜¤ëŠ˜ì˜ ì„±ì·¨ê°€ ë‚´ì¼ì˜ ë™ê¸°ê°€ ë  ê±°ì˜ˆìš”. ì •ë§ ì˜í•˜ì…¨ìŠµë‹ˆë‹¤!",
            "í•„ìˆ˜ ìš´ë™ì„ ëª¨ë‘ ì™„ë£Œí•˜ì…¨ë„¤ìš”! ë‹¤ìŒì—ë„ í™”ì´íŒ…ì´ì—ìš”.",
            "ê±´ê°•í•œ ì‚¶ì„ ìœ„í•œ ë…¸ë ¥ì´ ë¹›ë‚˜ë„¤ìš”. ì˜¤ëŠ˜ë„ ìˆ˜ê³ í•˜ì…¨ì–´ìš”!",
            "ê³„íš ë‹¬ì„±ì˜ ê¸°ì¨ì„ ëŠê»´ë³´ì„¸ìš”! ë‹¹ì‹ ì€ í•´ë‚¼ ìˆ˜ ìˆì–´ìš”."
        ];

        const celebrationEmojis = ["ğŸ‰", "ğŸ†", "ğŸŠ", "ğŸ’ª", "âœ¨", "ğŸš€", "ğŸ†", "ğŸŒŸ"];

        function checkPlanCompletion(newExercise) {
            const selectedDate = document.getElementById('recordDate').value;
            const plans = JSON.parse(localStorage.getItem(`plans_${selectedDate}`)) || [];
            
            // ìƒˆë¡œ ì¶”ê°€ëœ ìš´ë™ê³¼ ì¼ì¹˜í•˜ëŠ” ê³„íš ì°¾ê¸°
            const matchingPlan = plans.find(plan => 
                plan.name === newExercise.name && 
                plan.duration <= newExercise.duration
            );
            
            if (matchingPlan) {
                showEncouragementModal(matchingPlan, newExercise);
                return true;
            }
            
            return false;
        }

        function showEncouragementModal(plan, exercise) {
            const modal = document.getElementById('encouragementModal');
            const emojiElement = document.getElementById('celebrationEmoji');
            const messageElement = document.getElementById('encouragementMessage');
            const detailsElement = document.getElementById('achievementDetails');
            
            // ëœë¤ ê°ì • í‘œí˜„ ë° ë©”ì‹œì§€
            const randomEmoji = celebrationEmojis[Math.floor(Math.random() * celebrationEmojis.length)];
            const randomMessage = encouragementMessages[Math.floor(Math.random() * encouragementMessages.length)];
            
            emojiElement.textContent = randomEmoji;
            messageElement.textContent = randomMessage;
            
            // ì„±ì·¨ ì„¸ë¶€ ì •ë³´
            const timeDiff = exercise.duration - plan.duration;
            const calorieDiff = exercise.calories - plan.calories;
            
            detailsElement.innerHTML = `
                <div class="achievement-detail">
                    <span>ìš´ë™:</span>
                    <strong>${exercise.name}</strong>
                </div>
                <div class="achievement-detail">
                    <span>ê³„íš ì‹œê°„:</span>
                    <strong>${plan.duration}ë¶„</strong>
                </div>
                <div class="achievement-detail">
                    <span>ì‹¤ì œ ì‹œê°„:</span>
                    <strong>${exercise.duration}ë¶„ ${timeDiff > 0 ? '(+' + timeDiff + 'ë¶„!)' : ''}</strong>
                </div>
                <div class="achievement-detail">
                    <span>ì˜ˆìƒ ì¹¼ë¡œë¦¬:</span>
                    <strong>${plan.calories}kcal</strong>
                </div>
                <div class="achievement-detail">
                    <span>ì‹¤ì œ ì¹¼ë¡œë¦¬:</span>
                    <strong>${exercise.calories}kcal ${calorieDiff > 0 ? '(+' + calorieDiff + 'kcal!)' : ''}</strong>
                </div>
            `;
            
            modal.classList.add('show');
        }

        function closeEncouragementModal() {
            const modal = document.getElementById('encouragementModal');
            modal.classList.remove('show');
        }

        // ê¸°ì¡´ ìš´ë™ ê¸°ë¡ ì¶”ê°€ í•¨ìˆ˜ ìˆ˜ì •
        const originalExerciseFormSubmit = document.getElementById('exerciseForm').onsubmit;
        
        document.getElementById('exerciseForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const selectedDate = document.getElementById('recordDate').value;
            const exercise = {
                name: document.getElementById('exerciseName').value,
                duration: parseInt(document.getElementById('exerciseDuration').value),
                calories: parseInt(document.getElementById('exerciseCalories').value),
                timestamp: new Date().toLocaleTimeString()
            };
            
            const exercises = JSON.parse(localStorage.getItem(`exercises_${selectedDate}`)) || [];
            exercises.push(exercise);
            localStorage.setItem(`exercises_${selectedDate}`, JSON.stringify(exercises));
            
            displayExercises(exercises);
            updateSummary(exercises, JSON.parse(localStorage.getItem(`foods_${selectedDate}`)) || []);
            
            // ê³„íš ë‹¬ì„± ê²€ì‚¬ ë° ê²©ë ¤ ë©”ì‹œì§€
            checkPlanCompletion(exercise);
            
            // ì¶”ì²œ ìš´ë™ ì¬ê²€í† 
            checkAndShowRecommendations();
            
            // í¼ ì´ˆê¸°í™”
            this.reset();
            document.getElementById('exerciseCalories').value = '';
        });

        // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸° (ê²©ë ¤ ëª¨ë‹¬ ì œì™¸)
        window.addEventListener('click', function(event) {
            const exerciseModal = document.getElementById('editExerciseModal');
            const foodModal = document.getElementById('editFoodModal');
            const planModal = document.getElementById('editPlanModal');
            const profileModal = document.getElementById('profileModal');
            const encouragementModal = document.getElementById('encouragementModal');
            
            if (event.target === exerciseModal) {
                closeEditExerciseModal();
            } else if (event.target === foodModal) {
                closeEditFoodModal();
            } else if (event.target === planModal) {
                closeEditPlanModal();
            } else if (event.target === profileModal) {
                closeProfileModal();
            }
            // ê²©ë ¤ ëª¨ë‹¬ì€ í™•ì¸ ë²„íŠ¼ìœ¼ë¡œë§Œ ë‹«ê¸°
        });

        // ì´ˆê¸° ë°ì´í„° ë¡œë“œ ë° ê²€ì¦ ê¸°ëŠ¥ ì¶”ê°€
        loadUserProfile();
        loadData();
        addNutritionValidation();
    </script>
</body>
</html>